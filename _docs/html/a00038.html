<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Tarzan Pre-2.0 Trunk Build: s3.class.php Source File</title>
<link href="tarzan.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<h1>s3.class.php</h1><a href="a00017.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php<span class="comment"></span>
<a name="l00002"></a>00002 <span class="comment">/**</span>
<a name="l00003"></a>00003 <span class="comment"> * AMAZON SIMPLE STORAGE SERVICE (S3)</span>
<a name="l00004"></a>00004 <span class="comment"> * http://s3.amazonaws.com</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * @category Tarzan</span>
<a name="l00007"></a>00007 <span class="comment"> * @package S3</span>
<a name="l00008"></a>00008 <span class="comment"> * @version 2008.08.02</span>
<a name="l00009"></a>00009 <span class="comment"> * @copyright 2006-2008 Ryan Parman, LifeNexus Digital, Inc., and contributors.</span>
<a name="l00010"></a>00010 <span class="comment"> * @license http://opensource.org/licenses/bsd-license.php Simplified BSD License</span>
<a name="l00011"></a>00011 <span class="comment"> * @link http://tarzan-aws.com Tarzan</span>
<a name="l00012"></a>00012 <span class="comment"> * @link http://s3.amazonaws.com Amazon S3</span>
<a name="l00013"></a>00013 <span class="comment"> * @see README</span>
<a name="l00014"></a>00014 <span class="comment"> */</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="comment">/*%******************************************************************************************%*/</span>
<a name="l00018"></a>00018 <span class="comment">// CONSTANTS</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">/**</span>
<a name="l00021"></a>00021 <span class="comment"> * Specify the US location.</span>
<a name="l00022"></a>00022 <span class="comment"> */</span>
<a name="l00023"></a><a class="code" href="a00017_f2eefc95d3c9eed134c85f5d21cb886b.html#f2eefc95d3c9eed134c85f5d21cb886b">00023</a> define(<span class="stringliteral">'S3_LOCATION_US'</span>, <span class="stringliteral">'us'</span>);
<a name="l00024"></a>00024 <span class="comment"></span>
<a name="l00025"></a>00025 <span class="comment">/**</span>
<a name="l00026"></a>00026 <span class="comment"> * Specify the European Union (EU) location.</span>
<a name="l00027"></a>00027 <span class="comment"> */</span>
<a name="l00028"></a><a class="code" href="a00017_277297965a06985360e508778695926b.html#277297965a06985360e508778695926b">00028</a> define(<span class="stringliteral">'S3_LOCATION_EU'</span>, <span class="stringliteral">'eu'</span>);
<a name="l00029"></a>00029 <span class="comment"></span>
<a name="l00030"></a>00030 <span class="comment">/**</span>
<a name="l00031"></a>00031 <span class="comment"> * ACL: Owner-only read/write.</span>
<a name="l00032"></a>00032 <span class="comment"> */</span>
<a name="l00033"></a><a class="code" href="a00017_26b272ddfab8427eac3d883fb4f0356f.html#26b272ddfab8427eac3d883fb4f0356f">00033</a> define(<span class="stringliteral">'S3_ACL_PRIVATE'</span>, <span class="stringliteral">'private'</span>);
<a name="l00034"></a>00034 <span class="comment"></span>
<a name="l00035"></a>00035 <span class="comment">/**</span>
<a name="l00036"></a>00036 <span class="comment"> * ACL: Owner read/write, public read.</span>
<a name="l00037"></a>00037 <span class="comment"> */</span>
<a name="l00038"></a><a class="code" href="a00017_8a93bf8a4901a811870a8af621ab285e.html#8a93bf8a4901a811870a8af621ab285e">00038</a> define(<span class="stringliteral">'S3_ACL_PUBLIC'</span>, <span class="stringliteral">'public-read'</span>);
<a name="l00039"></a>00039 <span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment">/**</span>
<a name="l00041"></a>00041 <span class="comment"> * ACL: Public read/write.</span>
<a name="l00042"></a>00042 <span class="comment"> */</span>
<a name="l00043"></a><a class="code" href="a00017_a89c837cb7852fff070a32814c5e8f3a.html#a89c837cb7852fff070a32814c5e8f3a">00043</a> define(<span class="stringliteral">'S3_ACL_OPEN'</span>, <span class="stringliteral">'public-read-write'</span>);
<a name="l00044"></a>00044 <span class="comment"></span>
<a name="l00045"></a>00045 <span class="comment">/**</span>
<a name="l00046"></a>00046 <span class="comment"> * ACL: Owner read/write, authenticated read.</span>
<a name="l00047"></a>00047 <span class="comment"> */</span>
<a name="l00048"></a><a class="code" href="a00017_d2dd8aa15cb5bdb82b4f8f3df9c67e1c.html#d2dd8aa15cb5bdb82b4f8f3df9c67e1c">00048</a> define(<span class="stringliteral">'S3_ACL_AUTH_READ'</span>, <span class="stringliteral">'authenticated-read'</span>);
<a name="l00049"></a>00049 <span class="comment"></span>
<a name="l00050"></a>00050 <span class="comment">/**</span>
<a name="l00051"></a>00051 <span class="comment"> * PCRE: Match all items</span>
<a name="l00052"></a>00052 <span class="comment"> */</span>
<a name="l00053"></a><a class="code" href="a00017_3a75518673c949b49359471ce7293d28.html#3a75518673c949b49359471ce7293d28">00053</a> define(<span class="stringliteral">'S3_PCRE_ALL'</span>, <span class="stringliteral">'/.*/i'</span>);
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="comment">/*%******************************************************************************************%*/</span>
<a name="l00057"></a>00057 <span class="comment">// MAIN CLASS</span>
<a name="l00058"></a>00058 <span class="comment"></span>
<a name="l00059"></a>00059 <span class="comment">/**</span>
<a name="l00060"></a>00060 <span class="comment"> * Container for all Amazon S3-related methods.</span>
<a name="l00061"></a>00061 <span class="comment"> * </span>
<a name="l00062"></a>00062 <span class="comment"> * @section example Example Usage:</span>
<a name="l00063"></a>00063 <span class="comment"> * @include s3/__construct.phps</span>
<a name="l00064"></a>00064 <span class="comment"> */</span>
<a name="l00065"></a><a class="code" href="a00003.html">00065</a> <span class="keyword">class </span><a class="code" href="a00003.html">AmazonS3</a> <span class="keyword">extends</span> <a class="code" href="a00006.html">TarzanCore</a>
<a name="l00066"></a>00066 {<span class="comment"></span>
<a name="l00067"></a>00067 <span class="comment">        /**</span>
<a name="l00068"></a>00068 <span class="comment">         * @var The request URL.</span>
<a name="l00069"></a>00069 <span class="comment">         */</span>
<a name="l00070"></a><a class="code" href="a00003_9c8e8b2bcab16a0cc56e6d5e248fa184.html#9c8e8b2bcab16a0cc56e6d5e248fa184">00070</a>         var <a class="code" href="a00003_9c8e8b2bcab16a0cc56e6d5e248fa184.html#9c8e8b2bcab16a0cc56e6d5e248fa184">$request_url</a>;
<a name="l00071"></a>00071 <span class="comment"></span>
<a name="l00072"></a>00072 <span class="comment">        /**</span>
<a name="l00073"></a>00073 <span class="comment">         * @var The virtual host setting.</span>
<a name="l00074"></a>00074 <span class="comment">         */</span>
<a name="l00075"></a><a class="code" href="a00003_294af23ca36464b7a5661d8080ce43d1.html#294af23ca36464b7a5661d8080ce43d1">00075</a>         var <a class="code" href="a00003_294af23ca36464b7a5661d8080ce43d1.html#294af23ca36464b7a5661d8080ce43d1">$vhost</a>;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 
<a name="l00078"></a>00078         <span class="comment">/*%******************************************************************************************%*/</span>
<a name="l00079"></a>00079         <span class="comment">// CONSTRUCTOR</span>
<a name="l00080"></a>00080 <span class="comment"></span>
<a name="l00081"></a>00081 <span class="comment">        /**</span>
<a name="l00082"></a>00082 <span class="comment">         * Constructor</span>
<a name="l00083"></a>00083 <span class="comment">         * </span>
<a name="l00084"></a>00084 <span class="comment">         * @public</span>
<a name="l00085"></a>00085 <span class="comment">         * @param string $key Your Amazon API Key. If blank, it will look for the AWS_KEY constant.</span>
<a name="l00086"></a>00086 <span class="comment">         * @param string $secret_key Your Amazon API Secret Key. If blank, it will look for the AWS_SECRET_KEY constant.</span>
<a name="l00087"></a>00087 <span class="comment">         * @return bool FALSE if no valid values are set, otherwise true.</span>
<a name="l00088"></a>00088 <span class="comment">         * @section example Example Usage:</span>
<a name="l00089"></a>00089 <span class="comment">         * @include s3/__construct.phps</span>
<a name="l00090"></a>00090 <span class="comment">         */</span>
<a name="l00091"></a><a class="code" href="a00003_a9de91fc68b91819d5cdff8bd0cfe422.html#a9de91fc68b91819d5cdff8bd0cfe422">00091</a>         <span class="keyword">public</span> function <a class="code" href="a00003_a9de91fc68b91819d5cdff8bd0cfe422.html#a9de91fc68b91819d5cdff8bd0cfe422">__construct</a>(<a class="code" href="a00006_84e78a190ed4df00d33fb04050b0b5f3.html#84e78a190ed4df00d33fb04050b0b5f3">$key</a> = null, <a class="code" href="a00006_cdb3e15c2f29239ddc784e3b28e7050c.html#cdb3e15c2f29239ddc784e3b28e7050c">$secret_key</a> = null)
<a name="l00092"></a>00092         {
<a name="l00093"></a>00093                 $this-&gt;vhost = null;
<a name="l00094"></a>00094                 $this-&gt;api_version = <span class="stringliteral">'2006-03-01'</span>;
<a name="l00095"></a>00095                 parent::__construct(<a class="code" href="a00006_84e78a190ed4df00d33fb04050b0b5f3.html#84e78a190ed4df00d33fb04050b0b5f3">$key</a>, <a class="code" href="a00006_cdb3e15c2f29239ddc784e3b28e7050c.html#cdb3e15c2f29239ddc784e3b28e7050c">$secret_key</a>);
<a name="l00096"></a>00096         }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 
<a name="l00099"></a>00099         <span class="comment">/*%******************************************************************************************%*/</span>
<a name="l00100"></a>00100         <span class="comment">// AUTHENTICATION</span>
<a name="l00101"></a>00101 <span class="comment"></span>
<a name="l00102"></a>00102 <span class="comment">        /**</span>
<a name="l00103"></a>00103 <span class="comment">         * Authenticate</span>
<a name="l00104"></a>00104 <span class="comment">         *</span>
<a name="l00105"></a>00105 <span class="comment">         * Authenticates a connection to S3.</span>
<a name="l00106"></a>00106 <span class="comment">         *</span>
<a name="l00107"></a>00107 <span class="comment">         * @access public</span>
<a name="l00108"></a>00108 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used.</span>
<a name="l00109"></a>00109 <span class="comment">         * @param array $opt (Optional) Associative array of parameters for authenticating. See the individual methods for allowed keys.</span>
<a name="l00110"></a>00110 <span class="comment">         * @param string $location (Do Not Use) Used internally by this function on occasions when S3 returns a redirect code and it needs to call itself recursively.</span>
<a name="l00111"></a>00111 <span class="comment">         * @param integer $redirects (Do Not Use) Used internally by this function on occasions when S3 returns a redirect code and it needs to call itself recursively.</span>
<a name="l00112"></a>00112 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00113"></a>00113 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/RESTAuthentication.html</span>
<a name="l00114"></a>00114 <span class="comment">         */</span>
<a name="l00115"></a><a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">00115</a>         <span class="keyword">public</span> function <a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt = null, $location = null, $redirects = 0)
<a name="l00116"></a>00116         {
<a name="l00117"></a>00117                 <span class="comment">// If nothing was passed in, don't do anything.</span>
<a name="l00118"></a>00118                 <span class="keywordflow">if</span> (!$opt)
<a name="l00119"></a>00119                 {
<a name="l00120"></a>00120                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00121"></a>00121                 }
<a name="l00122"></a>00122                 <span class="keywordflow">else</span>
<a name="l00123"></a>00123                 {
<a name="l00124"></a>00124                         <span class="comment">// Set default values</span>
<a name="l00125"></a>00125                         $bucket = strtolower($bucket);
<a name="l00126"></a>00126                         $acl = null;
<a name="l00127"></a>00127                         $body = null;
<a name="l00128"></a>00128                         $contentType = null;
<a name="l00129"></a>00129                         $delimiter = null;
<a name="l00130"></a>00130                         $filename = null;
<a name="l00131"></a>00131                         $marker = null;
<a name="l00132"></a>00132                         $maxKeys = null;
<a name="l00133"></a>00133                         $method = null;
<a name="l00134"></a>00134                         $prefix = null;
<a name="l00135"></a>00135                         $verb = null;
<a name="l00136"></a>00136                         $lastmodified = null;
<a name="l00137"></a>00137                         $etag = null;
<a name="l00138"></a>00138                         $qsa = null;
<a name="l00139"></a>00139                         $md5 = null;
<a name="l00140"></a>00140                         $meta = null;
<a name="l00141"></a>00141                         $hmeta = null;
<a name="l00142"></a>00142                         $range = null;
<a name="l00143"></a>00143                         $returnCurlHandle = null;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145                         <span class="comment">// Break the array into individual variables, while storing the original.</span>
<a name="l00146"></a>00146                         $_opt = $opt;
<a name="l00147"></a>00147                         extract($opt);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149                         $filename = rawurlencode($filename);
<a name="l00150"></a>00150 
<a name="l00151"></a>00151                         <span class="comment">// Set hostname</span>
<a name="l00152"></a>00152                         <span class="keywordflow">if</span> ($this-&gt;vhost)
<a name="l00153"></a>00153                         {
<a name="l00154"></a>00154                                 $hostname = $this-&gt;vhost;
<a name="l00155"></a>00155                         }
<a name="l00156"></a>00156                         elseif ($method == <span class="stringliteral">'list_buckets'</span>)
<a name="l00157"></a>00157                         {
<a name="l00158"></a>00158                                 $hostname = <span class="stringliteral">'s3.amazonaws.com'</span>;
<a name="l00159"></a>00159                         }
<a name="l00160"></a>00160                         <span class="keywordflow">else</span>
<a name="l00161"></a>00161                         {
<a name="l00162"></a>00162                                 $hostname = $bucket . <span class="stringliteral">'.s3.amazonaws.com'</span>;
<a name="l00163"></a>00163                         }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165                         <span class="comment">// Get the UTC timestamp in RFC 2616 format</span>
<a name="l00166"></a>00166                         $since_epoch = time() + $this-&gt;<a class="code" href="a00006_442c34311e9a195e3dff6ac7dbdd903d.html#442c34311e9a195e3dff6ac7dbdd903d">adjust_offset</a>;
<a name="l00167"></a>00167                         $httpDate = gmdate(<a class="code" href="a00020_1d895bd8986515e3792a30ea36777b45.html#1d895bd8986515e3792a30ea36777b45">DATE_AWS_RFC2616</a>, $since_epoch);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169                         <span class="comment">// Generate the request string</span>
<a name="l00170"></a>00170                         $request = <span class="stringliteral">''</span>;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172                         <span class="comment">// Append additional parameters</span>
<a name="l00173"></a>00173                         $request .= <span class="charliteral">'/'</span> . $filename;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175                         <span class="comment">// List Object settings</span>
<a name="l00176"></a>00176                         <span class="keywordflow">if</span> ($method == <span class="stringliteral">'list_objects'</span>)
<a name="l00177"></a>00177                         {
<a name="l00178"></a>00178                                 <span class="keywordflow">if</span> (isset($prefix) &amp;&amp; !empty($prefix))
<a name="l00179"></a>00179                                 {
<a name="l00180"></a>00180                                         $request = <span class="stringliteral">'/?prefix='</span> . $prefix;
<a name="l00181"></a>00181                                 }
<a name="l00182"></a>00182                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($marker) &amp;&amp; !empty($marker))
<a name="l00183"></a>00183                                 {
<a name="l00184"></a>00184                                         $request = <span class="stringliteral">'/?marker='</span> . $marker;
<a name="l00185"></a>00185                                 }
<a name="l00186"></a>00186                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($maxKeys) &amp;&amp; !empty($maxKeys))
<a name="l00187"></a>00187                                 {
<a name="l00188"></a>00188                                         $request = <span class="stringliteral">'/?max-keys='</span> . $maxKeys;
<a name="l00189"></a>00189                                 }
<a name="l00190"></a>00190                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($delimiter) &amp;&amp; !empty($delimiter))
<a name="l00191"></a>00191                                 {
<a name="l00192"></a>00192                                         $request = <span class="stringliteral">'/?delimiter='</span> . $delimiter;
<a name="l00193"></a>00193                                 }
<a name="l00194"></a>00194                         }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196                         <span class="comment">// Logging</span>
<a name="l00197"></a>00197                         elseif ($method == <span class="stringliteral">'get_logs'</span>)
<a name="l00198"></a>00198                         {
<a name="l00199"></a>00199                                 $request .= <span class="stringliteral">'?logging'</span>;
<a name="l00200"></a>00200                                 $filename .= <span class="stringliteral">'?logging'</span>;
<a name="l00201"></a>00201                         }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203                         <span class="comment">// Get Bucket Locale settings</span>
<a name="l00204"></a>00204                         elseif ($method == <span class="stringliteral">'get_bucket_locale'</span>)
<a name="l00205"></a>00205                         {
<a name="l00206"></a>00206                                 $request = <span class="stringliteral">'/?location'</span>;
<a name="l00207"></a>00207                                 $filename = <span class="stringliteral">'?location'</span>;
<a name="l00208"></a>00208                         }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210                         <span class="comment">// Add ACL stuff if we're getting/setting ACL preferences.</span>
<a name="l00211"></a>00211                         elseif ($method == <span class="stringliteral">'get_bucket_acl'</span> || $method == <span class="stringliteral">'get_object_acl'</span>)
<a name="l00212"></a>00212                         {
<a name="l00213"></a>00213                                 $request .= <span class="stringliteral">'?acl'</span>;
<a name="l00214"></a>00214                                 $filename .= <span class="stringliteral">'?acl'</span>;
<a name="l00215"></a>00215                         }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217                         <span class="keywordflow">if</span> (!$request == <span class="charliteral">'/'</span>)
<a name="l00218"></a>00218                         {
<a name="l00219"></a>00219                                 $request = <span class="charliteral">'/'</span> . $request;
<a name="l00220"></a>00220                         }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222                         <span class="comment">// Prepare the request.</span>
<a name="l00223"></a>00223                         <span class="keywordflow">if</span> ($location)
<a name="l00224"></a>00224                         {
<a name="l00225"></a>00225                                 $this-&gt;request_url = $location;
<a name="l00226"></a>00226                         }
<a name="l00227"></a>00227                         <span class="keywordflow">else</span>
<a name="l00228"></a>00228                         {
<a name="l00229"></a>00229                                 $this-&gt;request_url = <span class="stringliteral">'http://'</span> . $hostname . $request;
<a name="l00230"></a>00230                         }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232                         <span class="comment">// Instantiate the request class</span>
<a name="l00233"></a>00233                         $req = <span class="keyword">new</span> $this-&gt;request_class($this-&gt;request_url);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235                         <span class="comment">// Do we have a verb?</span>
<a name="l00236"></a>00236                         <span class="keywordflow">if</span> (isset($verb) &amp;&amp; !empty($verb))
<a name="l00237"></a>00237                         {
<a name="l00238"></a>00238                                 $req-&gt;setMethod($verb);
<a name="l00239"></a>00239                         }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241                         <span class="comment">// Do we have a contentType?</span>
<a name="l00242"></a>00242                         <span class="keywordflow">if</span> (isset($contentType) &amp;&amp; !empty($contentType))
<a name="l00243"></a>00243                         {
<a name="l00244"></a>00244                                 $req-&gt;addHeader(<span class="stringliteral">'Content-Type'</span>, $contentType);
<a name="l00245"></a>00245                         }
<a name="l00246"></a>00246                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($verb == <a class="code" href="a00020_12f047cd6da4c2ebf4f768664dfc8cb8.html#12f047cd6da4c2ebf4f768664dfc8cb8">HTTP_PUT</a>) <span class="comment">// Set a default value for HTTP_PUT</span>
<a name="l00247"></a>00247                         {
<a name="l00248"></a>00248                                 $contentType = <span class="stringliteral">'application/x-www-form-urlencoded'</span>;
<a name="l00249"></a>00249                         }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251                         <span class="comment">// Do we have a date?</span>
<a name="l00252"></a>00252                         <span class="keywordflow">if</span> (isset($httpDate) &amp;&amp; !empty($httpDate))
<a name="l00253"></a>00253                         {
<a name="l00254"></a>00254                                 $req-&gt;addHeader(<span class="stringliteral">"Date"</span>, $httpDate);
<a name="l00255"></a>00255                         }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257                         <span class="comment">// Do we have ACL settings? (Optional in signed string)</span>
<a name="l00258"></a>00258                         <span class="keywordflow">if</span> (isset($acl) &amp;&amp; !empty($acl))
<a name="l00259"></a>00259                         {
<a name="l00260"></a>00260                                 $req-&gt;addHeader(<span class="stringliteral">"x-amz-acl"</span>, $acl);
<a name="l00261"></a>00261                                 $acl = <span class="stringliteral">'x-amz-acl:'</span> . $acl . <span class="stringliteral">"\n"</span>;
<a name="l00262"></a>00262                         }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264                         <span class="comment">// Do we have COPY settings?</span>
<a name="l00265"></a>00265                         <span class="keywordflow">if</span> ($method == <span class="stringliteral">'copy_object'</span>)
<a name="l00266"></a>00266                         {
<a name="l00267"></a>00267                                 $acl .= <span class="stringliteral">'x-amz-copy-source:/'</span> . $sourceBucket . <span class="charliteral">'/'</span> . $sourceObject . <span class="stringliteral">"\n"</span>;
<a name="l00268"></a>00268                                 $req-&gt;addHeader(<span class="stringliteral">'x-amz-copy-source'</span>, <span class="charliteral">'/'</span> . $sourceBucket . <span class="charliteral">'/'</span> . $sourceObject);
<a name="l00269"></a>00269                         }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271                         <span class="comment">// Are we checking for changes?</span>
<a name="l00272"></a>00272                         <span class="keywordflow">if</span> ($lastmodified &amp;&amp; $etag)
<a name="l00273"></a>00273                         {
<a name="l00274"></a>00274                                 $req-&gt;addHeader(<span class="stringliteral">'If-Modified-Since'</span>, $lastmodified);
<a name="l00275"></a>00275                                 $req-&gt;addHeader(<span class="stringliteral">'If-None-Match'</span>, $etag);
<a name="l00276"></a>00276                         }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278                         <span class="comment">// Partial content range</span>
<a name="l00279"></a>00279                         <span class="keywordflow">if</span> ($range)
<a name="l00280"></a>00280                         {
<a name="l00281"></a>00281                                 $req-&gt;addHeader(<span class="stringliteral">'Range'</span>, <span class="stringliteral">'bytes='</span> . $range);
<a name="l00282"></a>00282                         }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284                         <span class="comment">// Add a body if we're creating</span>
<a name="l00285"></a>00285                         <span class="keywordflow">if</span> ($method == <span class="stringliteral">'create_object'</span> || $method == <span class="stringliteral">'create_bucket'</span>)
<a name="l00286"></a>00286                         {
<a name="l00287"></a>00287                                 <span class="keywordflow">if</span> (isset($body) &amp;&amp; !empty($body))
<a name="l00288"></a>00288                                 {
<a name="l00289"></a>00289                                         $req-&gt;setBody($body);
<a name="l00290"></a>00290                                         $md5 = $this-&gt;util-&gt;hex_to_base64(md5($body));
<a name="l00291"></a>00291                                         $req-&gt;addHeader(<span class="stringliteral">'Content-MD5'</span>, $md5);
<a name="l00292"></a>00292                                 }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294                                 <span class="comment">// Add any meta headers.</span>
<a name="l00295"></a>00295                                 <span class="keywordflow">if</span> ($meta)
<a name="l00296"></a>00296                                 {
<a name="l00297"></a>00297                                         uksort($meta, <span class="stringliteral">'strnatcasecmp'</span>);
<a name="l00298"></a>00298 
<a name="l00299"></a>00299                                         <span class="keywordflow">foreach</span> ($meta as $k =&gt; $v)
<a name="l00300"></a>00300                                         {
<a name="l00301"></a>00301                                                 $req-&gt;addHeader(<span class="stringliteral">'x-amz-meta-'</span> . strtolower($k), $v);
<a name="l00302"></a>00302                                                 $hmeta .= <span class="stringliteral">'x-amz-meta-'</span> . strtolower($k) . <span class="charliteral">':'</span> . $v . <span class="stringliteral">"\n"</span>;
<a name="l00303"></a>00303                                         }
<a name="l00304"></a>00304                                 }
<a name="l00305"></a>00305                         }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307                         <span class="comment">// Data that will be "signed".</span>
<a name="l00308"></a>00308                         $filename = <span class="charliteral">'/'</span> . $filename;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310                         <span class="comment">// If we're listing buckets, there is no filename value.</span>
<a name="l00311"></a>00311                         <span class="keywordflow">if</span> ($method == <span class="stringliteral">'list_buckets'</span>)
<a name="l00312"></a>00312                         {
<a name="l00313"></a>00313                                 $filename = <span class="stringliteral">''</span>;
<a name="l00314"></a>00314                         }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316                         <span class="keywordflow">if</span> ($qsa)
<a name="l00317"></a>00317                         {
<a name="l00318"></a>00318                                 <span class="comment">// Prepare the string to sign</span>
<a name="l00319"></a>00319                                 $stringToSign = <span class="stringliteral">"$verb\n$md5\n$contentType\n$since_epoch\n$acl$hmeta/$bucket$filename"</span>;
<a name="l00320"></a>00320                         }
<a name="l00321"></a>00321                         <span class="keywordflow">else</span>
<a name="l00322"></a>00322                         {
<a name="l00323"></a>00323                                 <span class="comment">// Prepare the string to sign</span>
<a name="l00324"></a>00324                                 $stringToSign = <span class="stringliteral">"$verb\n$md5\n$contentType\n$httpDate\n$acl$hmeta/$bucket$filename"</span>;
<a name="l00325"></a>00325                         }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327                         <span class="comment">// Hash the AWS secret key and generate a signature for the request.</span>
<a name="l00328"></a>00328                         $signature = $this-&gt;util-&gt;hex_to_base64(hash_hmac(<span class="stringliteral">'sha1'</span>, $stringToSign, $this-&gt;secret_key));
<a name="l00329"></a>00329 
<a name="l00330"></a>00330                         <span class="comment">// Pass the developer key and signature</span>
<a name="l00331"></a>00331                         $req-&gt;addHeader(<span class="stringliteral">"Authorization"</span>, <span class="stringliteral">"AWS "</span> . $this-&gt;key . <span class="stringliteral">":"</span> . $signature);
<a name="l00332"></a>00332 
<a name="l00333"></a>00333                         <span class="comment">// If we have a "true" value for returnCurlHandle, do that instead of completing the request.</span>
<a name="l00334"></a>00334                         <span class="keywordflow">if</span> ($returnCurlHandle)
<a name="l00335"></a>00335                         {
<a name="l00336"></a>00336                                 <span class="keywordflow">return</span> $req-&gt;prepRequest();
<a name="l00337"></a>00337                         }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339                         <span class="comment">// Are we getting a Query String Auth?</span>
<a name="l00340"></a>00340                         <span class="keywordflow">if</span> ($qsa)
<a name="l00341"></a>00341                         {
<a name="l00342"></a>00342                                 <span class="keywordflow">return</span> array(
<a name="l00343"></a>00343                                         <span class="stringliteral">'bucket'</span> =&gt; $bucket,
<a name="l00344"></a>00344                                         <span class="stringliteral">'filename'</span> =&gt; $filename,
<a name="l00345"></a>00345                                         <span class="stringliteral">'key'</span> =&gt; $this-&gt;key,
<a name="l00346"></a>00346                                         <span class="stringliteral">'expires'</span> =&gt; $since_epoch,
<a name="l00347"></a>00347                                         <span class="stringliteral">'signature'</span> =&gt; $signature,
<a name="l00348"></a>00348                                 );
<a name="l00349"></a>00349                         }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351                         <span class="comment">// Send!</span>
<a name="l00352"></a>00352                         $req-&gt;sendRequest();
<a name="l00353"></a>00353 
<a name="l00354"></a>00354                         <span class="comment">// Prepare the response.</span>
<a name="l00355"></a>00355                         $headers = $req-&gt;getResponseHeader();
<a name="l00356"></a>00356                         $headers[<span class="stringliteral">'x-tarzan-redirects'</span>] = $redirects;
<a name="l00357"></a>00357                         $headers[<span class="stringliteral">'x-tarzan-requesturl'</span>] = $this-&gt;request_url;
<a name="l00358"></a>00358                         $headers[<span class="stringliteral">'x-tarzan-stringtosign'</span>] = $stringToSign;
<a name="l00359"></a>00359                         $headers[<span class="stringliteral">'x-tarzan-requestheaders'</span>] = $req-&gt;request_headers;
<a name="l00360"></a>00360                         $data = <span class="keyword">new</span> $this-&gt;response_class($headers, $req-&gt;getResponseBody(), $req-&gt;getResponseCode());
<a name="l00361"></a>00361 
<a name="l00362"></a>00362                         <span class="comment">// Did Amazon tell us to redirect? Typically happens for multiple rapid requests EU datacenters.</span>
<a name="l00363"></a>00363                         <span class="comment">// @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/Redirects.html</span>
<a name="l00364"></a>00364                         <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>) $req-&gt;getResponseCode() == 307) <span class="comment">// Temporary redirect to new endpoint.</span>
<a name="l00365"></a>00365                         {
<a name="l00366"></a>00366                                 $redirects++;
<a name="l00367"></a>00367                                 $data = $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, 
<a name="l00368"></a>00368                                         $_opt, 
<a name="l00369"></a>00369                                         $headers[<span class="stringliteral">'location'</span>], 
<a name="l00370"></a>00370                                         $redirects);
<a name="l00371"></a>00371                         }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373                         <span class="comment">// Return!</span>
<a name="l00374"></a>00374                         <span class="keywordflow">return</span> $data;
<a name="l00375"></a>00375                 }
<a name="l00376"></a>00376         }
<a name="l00377"></a>00377 <span class="comment"></span>
<a name="l00378"></a>00378 <span class="comment">        /**</span>
<a name="l00379"></a>00379 <span class="comment">         * Set Virtual Host</span>
<a name="l00380"></a>00380 <span class="comment">         * </span>
<a name="l00381"></a>00381 <span class="comment">         * Use this virtual host instead of the normal bucket.s3.amazonaws.com domain.</span>
<a name="l00382"></a>00382 <span class="comment">         * </span>
<a name="l00383"></a>00383 <span class="comment">         * @access public</span>
<a name="l00384"></a>00384 <span class="comment">         * @param string $vhost (Required) The hostname to use instead of bucket.s3.amazonaws.com.</span>
<a name="l00385"></a>00385 <span class="comment">         * @return void</span>
<a name="l00386"></a>00386 <span class="comment">         * @section example Example Usage:</span>
<a name="l00387"></a>00387 <span class="comment">         * @include s3/set_vhost.phps</span>
<a name="l00388"></a>00388 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?VirtualHosting.html</span>
<a name="l00389"></a>00389 <span class="comment">         */</span>
<a name="l00390"></a><a class="code" href="a00003_77c40f0c3d121a4d981544e13d9b4c6c.html#77c40f0c3d121a4d981544e13d9b4c6c">00390</a>         <span class="keyword">public</span> function <a class="code" href="a00003_77c40f0c3d121a4d981544e13d9b4c6c.html#77c40f0c3d121a4d981544e13d9b4c6c">set_vhost</a>(<a class="code" href="a00003_294af23ca36464b7a5661d8080ce43d1.html#294af23ca36464b7a5661d8080ce43d1">$vhost</a>)
<a name="l00391"></a>00391         {
<a name="l00392"></a>00392                 $this-&gt;vhost = <a class="code" href="a00003_294af23ca36464b7a5661d8080ce43d1.html#294af23ca36464b7a5661d8080ce43d1">$vhost</a>;
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 
<a name="l00396"></a>00396         <span class="comment">/*%******************************************************************************************%*/</span>
<a name="l00397"></a>00397         <span class="comment">// BUCKET METHODS</span>
<a name="l00398"></a>00398 <span class="comment"></span>
<a name="l00399"></a>00399 <span class="comment">        /**</span>
<a name="l00400"></a>00400 <span class="comment">         * Create Bucket</span>
<a name="l00401"></a>00401 <span class="comment">         *</span>
<a name="l00402"></a>00402 <span class="comment">         * The bucket holds all of your objects, and provides a globally unique namespace in which you </span>
<a name="l00403"></a>00403 <span class="comment">         * can manage the keys that identify objects. A bucket can hold any number of objects.</span>
<a name="l00404"></a>00404 <span class="comment">         *</span>
<a name="l00405"></a>00405 <span class="comment">         * @access public</span>
<a name="l00406"></a>00406 <span class="comment">         * @param string $bucket (Required) The name of the bucket to create.</span>
<a name="l00407"></a>00407 <span class="comment">         * @param string $locale (Optional) Sets the preferred geographical location for the bucket. Accepts S3_LOCATION_US or S3_LOCATION_EU. Defaults to S3_LOCATION_US.</span>
<a name="l00408"></a>00408 <span class="comment">         * @param boolean $returnCurlHandle (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.</span>
<a name="l00409"></a>00409 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00410"></a>00410 <span class="comment">         * @section example Example Usage:</span>
<a name="l00411"></a>00411 <span class="comment">         * @include s3/create_bucket.phps</span>
<a name="l00412"></a>00412 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/RESTBucketPUT.html</span>
<a name="l00413"></a>00413 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/UsingBucket.html</span>
<a name="l00414"></a>00414 <span class="comment">         */</span>
<a name="l00415"></a><a class="code" href="a00003_67e44f0aabed7666952d3189a94b4ddb.html#67e44f0aabed7666952d3189a94b4ddb">00415</a>         <span class="keyword">public</span> function <a class="code" href="a00003_67e44f0aabed7666952d3189a94b4ddb.html#67e44f0aabed7666952d3189a94b4ddb">create_bucket</a>($bucket, $locale = null, $returnCurlHandle = null)
<a name="l00416"></a>00416         {
<a name="l00417"></a>00417                 <span class="comment">// Defaults</span>
<a name="l00418"></a>00418                 $body = null;
<a name="l00419"></a>00419                 $contentType = null;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421                 <span class="keywordflow">if</span> ($locale)
<a name="l00422"></a>00422                 {
<a name="l00423"></a>00423                         <span class="keywordflow">switch</span>(strtolower($locale))
<a name="l00424"></a>00424                         {
<a name="l00425"></a>00425                                 <span class="keywordflow">case</span> <span class="stringliteral">'eu'</span>:
<a name="l00426"></a>00426                                         $body = <span class="stringliteral">'&lt;CreateBucketConfiguration&gt;&lt;LocationConstraint&gt;'</span> . strtoupper($locale) . <span class="stringliteral">'&lt;/LocationConstraint&gt;&lt;/CreateBucketConfiguration&gt;'</span>;
<a name="l00427"></a>00427                                         $contentType = <span class="stringliteral">'application/xml'</span>;
<a name="l00428"></a>00428                                         <span class="keywordflow">break</span>;
<a name="l00429"></a>00429                         }
<a name="l00430"></a>00430                 }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432                 <span class="comment">// Authenticate to S3</span>
<a name="l00433"></a>00433                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, array(
<a name="l00434"></a>00434                         <span class="stringliteral">'verb'</span> =&gt; <a class="code" href="a00020_12f047cd6da4c2ebf4f768664dfc8cb8.html#12f047cd6da4c2ebf4f768664dfc8cb8">HTTP_PUT</a>,
<a name="l00435"></a>00435                         <span class="stringliteral">'method'</span> =&gt; <span class="stringliteral">'create_bucket'</span>,
<a name="l00436"></a>00436                         <span class="stringliteral">'body'</span> =&gt; $body,
<a name="l00437"></a>00437                         <span class="stringliteral">'contentType'</span> =&gt; $contentType,
<a name="l00438"></a>00438                         <span class="stringliteral">'returnCurlHandle'</span> =&gt; $returnCurlHandle
<a name="l00439"></a>00439                 ));
<a name="l00440"></a>00440         }
<a name="l00441"></a>00441 <span class="comment"></span>
<a name="l00442"></a>00442 <span class="comment">        /**</span>
<a name="l00443"></a>00443 <span class="comment">         * Get Bucket</span>
<a name="l00444"></a>00444 <span class="comment">         *</span>
<a name="l00445"></a>00445 <span class="comment">         * Referred to as "GET Bucket" in the AWS docs, but implemented here as AmazonS3::list_objects().</span>
<a name="l00446"></a>00446 <span class="comment">         * </span>
<a name="l00447"></a>00447 <span class="comment">         * @access public</span>
<a name="l00448"></a>00448 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00449"></a>00449 <span class="comment">         * @see list_objects</span>
<a name="l00450"></a>00450 <span class="comment">         */</span>
<a name="l00451"></a><a class="code" href="a00003_d03623972b65d945063cb06906c90595.html#d03623972b65d945063cb06906c90595">00451</a>         <span class="keyword">public</span> function <a class="code" href="a00003_d03623972b65d945063cb06906c90595.html#d03623972b65d945063cb06906c90595">get_bucket</a>($bucket, $opt = null)
<a name="l00452"></a>00452         {
<a name="l00453"></a>00453                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_db502170660cf3cd5d19b337bfbc8382.html#db502170660cf3cd5d19b337bfbc8382">list_objects</a>($bucket, $opt);
<a name="l00454"></a>00454         }
<a name="l00455"></a>00455 <span class="comment"></span>
<a name="l00456"></a>00456 <span class="comment">        /**</span>
<a name="l00457"></a>00457 <span class="comment">         * Get Bucket Locale</span>
<a name="l00458"></a>00458 <span class="comment">         *</span>
<a name="l00459"></a>00459 <span class="comment">         * Lists the location constraint of the bucket. U.S.-based buckets have no response.</span>
<a name="l00460"></a>00460 <span class="comment">         *</span>
<a name="l00461"></a>00461 <span class="comment">         * @access public</span>
<a name="l00462"></a>00462 <span class="comment">         * @param string $bucket (Required) The name of the bucket to check.</span>
<a name="l00463"></a>00463 <span class="comment">         * @param boolean $returnCurlHandle (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.</span>
<a name="l00464"></a>00464 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00465"></a>00465 <span class="comment">         * @section example Example Usage:</span>
<a name="l00466"></a>00466 <span class="comment">         * @include s3/get_bucket_locale.phps</span>
<a name="l00467"></a>00467 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/RESTBucketLocationGET.html</span>
<a name="l00468"></a>00468 <span class="comment">         */</span>
<a name="l00469"></a><a class="code" href="a00003_f0c6274bee4bc0e3ed726277a02806c6.html#f0c6274bee4bc0e3ed726277a02806c6">00469</a>         <span class="keyword">public</span> function <a class="code" href="a00003_f0c6274bee4bc0e3ed726277a02806c6.html#f0c6274bee4bc0e3ed726277a02806c6">get_bucket_locale</a>($bucket, $returnCurlHandle = null)
<a name="l00470"></a>00470         {
<a name="l00471"></a>00471                 <span class="comment">// Add this to our request</span>
<a name="l00472"></a>00472                 $opt = array();
<a name="l00473"></a>00473                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_bee436b68fa82c549b1067404e0c33fe.html#bee436b68fa82c549b1067404e0c33fe">HTTP_GET</a>;
<a name="l00474"></a>00474                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'get_bucket_locale'</span>;
<a name="l00475"></a>00475                 $opt[<span class="stringliteral">'returnCurlHandle'</span>] = $returnCurlHandle;
<a name="l00476"></a>00476 
<a name="l00477"></a>00477                 <span class="comment">// Authenticate to S3</span>
<a name="l00478"></a>00478                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l00479"></a>00479         }
<a name="l00480"></a>00480 <span class="comment"></span>
<a name="l00481"></a>00481 <span class="comment">        /**</span>
<a name="l00482"></a>00482 <span class="comment">         * HEAD Bucket</span>
<a name="l00483"></a>00483 <span class="comment">         * </span>
<a name="l00484"></a>00484 <span class="comment">         * Reads only the HTTP headers of an object within a bucket.</span>
<a name="l00485"></a>00485 <span class="comment">         *</span>
<a name="l00486"></a>00486 <span class="comment">         * @access public</span>
<a name="l00487"></a>00487 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used.</span>
<a name="l00488"></a>00488 <span class="comment">         * @param boolean $returnCurlHandle (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.</span>
<a name="l00489"></a>00489 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00490"></a>00490 <span class="comment">         * @section example Example Usage:</span>
<a name="l00491"></a>00491 <span class="comment">         * @include s3/head_bucket.phps</span>
<a name="l00492"></a>00492 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/RESTObjectHEAD.html</span>
<a name="l00493"></a>00493 <span class="comment">         */</span>
<a name="l00494"></a><a class="code" href="a00003_65287b5f7b2c9df6db3d672c6bf82070.html#65287b5f7b2c9df6db3d672c6bf82070">00494</a>         <span class="keyword">public</span> function <a class="code" href="a00003_65287b5f7b2c9df6db3d672c6bf82070.html#65287b5f7b2c9df6db3d672c6bf82070">head_bucket</a>($bucket, $returnCurlHandle = null)
<a name="l00495"></a>00495         {
<a name="l00496"></a>00496                 <span class="comment">// Add this to our request</span>
<a name="l00497"></a>00497                 $opt = array();
<a name="l00498"></a>00498                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_f1c93e1abfb608f9d2c35759ae2d62e9.html#f1c93e1abfb608f9d2c35759ae2d62e9">HTTP_HEAD</a>;
<a name="l00499"></a>00499                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'head_bucket'</span>;
<a name="l00500"></a>00500                 $opt[<span class="stringliteral">'returnCurlHandle'</span>] = $returnCurlHandle;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502                 <span class="comment">// Authenticate to S3</span>
<a name="l00503"></a>00503                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l00504"></a>00504         }
<a name="l00505"></a>00505 <span class="comment"></span>
<a name="l00506"></a>00506 <span class="comment">        /**</span>
<a name="l00507"></a>00507 <span class="comment">         * If Bucket Exists</span>
<a name="l00508"></a>00508 <span class="comment">         * </span>
<a name="l00509"></a>00509 <span class="comment">         * Checks whether this bucket already exists in your account or not.</span>
<a name="l00510"></a>00510 <span class="comment">         * </span>
<a name="l00511"></a>00511 <span class="comment">         * @access public</span>
<a name="l00512"></a>00512 <span class="comment">         * @param string $bucket (Required) The name of the bucket to check.</span>
<a name="l00513"></a>00513 <span class="comment">         * @return boolean Whether it exists or not.</span>
<a name="l00514"></a>00514 <span class="comment">         * @section example Example Usage:</span>
<a name="l00515"></a>00515 <span class="comment">         * @include s3/if_bucket_exists.phps</span>
<a name="l00516"></a>00516 <span class="comment">         */</span>
<a name="l00517"></a><a class="code" href="a00003_f6ad3e916b4263ba03199a247d178315.html#f6ad3e916b4263ba03199a247d178315">00517</a>         <span class="keyword">public</span> function <a class="code" href="a00003_f6ad3e916b4263ba03199a247d178315.html#f6ad3e916b4263ba03199a247d178315">if_bucket_exists</a>($bucket)
<a name="l00518"></a>00518         {
<a name="l00519"></a>00519                 $header = $this-&gt;<a class="code" href="a00003_65287b5f7b2c9df6db3d672c6bf82070.html#65287b5f7b2c9df6db3d672c6bf82070">head_bucket</a>($bucket);
<a name="l00520"></a>00520                 <span class="keywordflow">return</span> $header-&gt;isOK();
<a name="l00521"></a>00521         }
<a name="l00522"></a>00522 <span class="comment"></span>
<a name="l00523"></a>00523 <span class="comment">        /**</span>
<a name="l00524"></a>00524 <span class="comment">         * Delete Bucket</span>
<a name="l00525"></a>00525 <span class="comment">         *</span>
<a name="l00526"></a>00526 <span class="comment">         * All objects in the bucket must be deleted before the bucket itself can be deleted.</span>
<a name="l00527"></a>00527 <span class="comment">         *</span>
<a name="l00528"></a>00528 <span class="comment">         * @access public</span>
<a name="l00529"></a>00529 <span class="comment">         * @param string $bucket (Required) The name of the bucket to delete.</span>
<a name="l00530"></a>00530 <span class="comment">         * @param boolean $force (Optional) Whether to force-delete the bucket and all of its contents. Defaults to false.</span>
<a name="l00531"></a>00531 <span class="comment">         * @param boolean $returnCurlHandle (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.</span>
<a name="l00532"></a>00532 <span class="comment">         * @return TarzanHTTPResponse|boolean Standard TarzanHTTPResponse if normal bucket deletion or if forced bucket deletion was successful, a boolean false if the forced deletion was unsuccessful.</span>
<a name="l00533"></a>00533 <span class="comment">         * @section example Example Usage:</span>
<a name="l00534"></a>00534 <span class="comment">         * @include s3/delete_bucket.phps</span>
<a name="l00535"></a>00535 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/RESTBucketDELETE.html</span>
<a name="l00536"></a>00536 <span class="comment">         */</span>
<a name="l00537"></a><a class="code" href="a00003_c4773c6d6a161c0baef522c4f47eca16.html#c4773c6d6a161c0baef522c4f47eca16">00537</a>         <span class="keyword">public</span> function <a class="code" href="a00003_c4773c6d6a161c0baef522c4f47eca16.html#c4773c6d6a161c0baef522c4f47eca16">delete_bucket</a>($bucket, $force = <span class="keyword">false</span>, $returnCurlHandle = null)
<a name="l00538"></a>00538         {
<a name="l00539"></a>00539                 <span class="comment">// Set default value</span>
<a name="l00540"></a>00540                 $success = <span class="keyword">true</span>;
<a name="l00541"></a>00541 
<a name="l00542"></a>00542                 <span class="keywordflow">if</span> ($force)
<a name="l00543"></a>00543                 {
<a name="l00544"></a>00544                         <span class="comment">// Delete all of the items from the bucket.</span>
<a name="l00545"></a>00545                         $success = $this-&gt;<a class="code" href="a00003_1e9648947ae7ab9f3842d430125b23c9.html#1e9648947ae7ab9f3842d430125b23c9">delete_all_objects</a>($bucket);
<a name="l00546"></a>00546                 }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548                 <span class="comment">// As long as we were successful...</span>
<a name="l00549"></a>00549                 <span class="keywordflow">if</span> ($success)
<a name="l00550"></a>00550                 {
<a name="l00551"></a>00551                         <span class="comment">// Add this to our request</span>
<a name="l00552"></a>00552                         $opt = array();
<a name="l00553"></a>00553                         $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_7c0802f4bae424cd442b2086c5859495.html#7c0802f4bae424cd442b2086c5859495">HTTP_DELETE</a>;
<a name="l00554"></a>00554                         $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'delete_bucket'</span>;
<a name="l00555"></a>00555                         $opt[<span class="stringliteral">'returnCurlHandle'</span>] = $returnCurlHandle;
<a name="l00556"></a>00556 
<a name="l00557"></a>00557                         <span class="comment">// Authenticate to S3</span>
<a name="l00558"></a>00558                         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l00559"></a>00559                 }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00562"></a>00562         }
<a name="l00563"></a>00563 <span class="comment"></span>
<a name="l00564"></a>00564 <span class="comment">        /**</span>
<a name="l00565"></a>00565 <span class="comment">         * Copy Bucket</span>
<a name="l00566"></a>00566 <span class="comment">         * </span>
<a name="l00567"></a>00567 <span class="comment">         * Copies the contents of a bucket into a new bucket.</span>
<a name="l00568"></a>00568 <span class="comment">         * </span>
<a name="l00569"></a>00569 <span class="comment">         * @access public</span>
<a name="l00570"></a>00570 <span class="comment">         * @param string $source_bucket (Required) The name of the source bucket.</span>
<a name="l00571"></a>00571 <span class="comment">         * @param string $dest_bucket (Required) The name of the destination bucket.</span>
<a name="l00572"></a>00572 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00573"></a>00573 <span class="comment">         * @section example Example Usage:</span>
<a name="l00574"></a>00574 <span class="comment">         * @include s3/copy_bucket.phps</span>
<a name="l00575"></a>00575 <span class="comment">         */</span>
<a name="l00576"></a><a class="code" href="a00003_1fa4f66eebde9030b61e55a5c3f7b91b.html#1fa4f66eebde9030b61e55a5c3f7b91b">00576</a>         <span class="keyword">public</span> function <a class="code" href="a00003_1fa4f66eebde9030b61e55a5c3f7b91b.html#1fa4f66eebde9030b61e55a5c3f7b91b">copy_bucket</a>($source_bucket, $dest_bucket)
<a name="l00577"></a>00577         {
<a name="l00578"></a>00578                 <span class="comment">// Since S3 can't yet copy across geographical locations, make sure that the new bucket matches the existing bucket.</span>
<a name="l00579"></a>00579                 $locale = $this-&gt;<a class="code" href="a00003_f0c6274bee4bc0e3ed726277a02806c6.html#f0c6274bee4bc0e3ed726277a02806c6">get_bucket_locale</a>($source_bucket);
<a name="l00580"></a>00580                 <span class="keywordflow">switch</span> ($locale-&gt;body)
<a name="l00581"></a>00581                 {
<a name="l00582"></a>00582                         <span class="keywordflow">case</span> <a class="code" href="a00017_277297965a06985360e508778695926b.html#277297965a06985360e508778695926b">S3_LOCATION_EU</a>:
<a name="l00583"></a>00583                                 $locale = <a class="code" href="a00017_277297965a06985360e508778695926b.html#277297965a06985360e508778695926b">S3_LOCATION_EU</a>;
<a name="l00584"></a>00584                                 <span class="keywordflow">break</span>;
<a name="l00585"></a>00585 
<a name="l00586"></a>00586                         <span class="keywordflow">default</span>:
<a name="l00587"></a>00587                                 $locale = <a class="code" href="a00017_f2eefc95d3c9eed134c85f5d21cb886b.html#f2eefc95d3c9eed134c85f5d21cb886b">S3_LOCATION_US</a>;
<a name="l00588"></a>00588                                 <span class="keywordflow">break</span>;
<a name="l00589"></a>00589                 }
<a name="l00590"></a>00590 
<a name="l00591"></a>00591                 $dest = $this-&gt;<a class="code" href="a00003_67e44f0aabed7666952d3189a94b4ddb.html#67e44f0aabed7666952d3189a94b4ddb">create_bucket</a>($dest_bucket, $locale);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593                 <span class="keywordflow">if</span> ($dest-&gt;isOK())
<a name="l00594"></a>00594                 {
<a name="l00595"></a>00595                         $list = $this-&gt;<a class="code" href="a00003_58758d28b2b11c5a98c635c34092f7be.html#58758d28b2b11c5a98c635c34092f7be">get_object_list</a>($source_bucket);
<a name="l00596"></a>00596                         $handles = array();
<a name="l00597"></a>00597         
<a name="l00598"></a>00598                         <span class="keywordflow">foreach</span> ($list as $item)
<a name="l00599"></a>00599                         {
<a name="l00600"></a>00600                                 $handles[] = $this-&gt;<a class="code" href="a00003_ee2902fc46016bb37e6c88d858ae7751.html#ee2902fc46016bb37e6c88d858ae7751">copy_object</a>($source_bucket, $item, $dest_bucket, $item, array(
<a name="l00601"></a>00601                                         <span class="stringliteral">'acl'</span> =&gt; <a class="code" href="a00017_26b272ddfab8427eac3d883fb4f0356f.html#26b272ddfab8427eac3d883fb4f0356f">S3_ACL_PRIVATE</a>, 
<a name="l00602"></a>00602                                         <span class="stringliteral">'returnCurlHandle'</span> =&gt; <span class="keyword">true</span>
<a name="l00603"></a>00603                                 ));
<a name="l00604"></a>00604                         }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606                         $request = <span class="keyword">new</span> $this-&gt;request_class(null);
<a name="l00607"></a>00607                         <span class="keywordflow">return</span> $request-&gt;sendMultiRequest($handles);
<a name="l00608"></a>00608                 }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00611"></a>00611         }
<a name="l00612"></a>00612 <span class="comment"></span>
<a name="l00613"></a>00613 <span class="comment">        /**</span>
<a name="l00614"></a>00614 <span class="comment">         * Rename Bucket</span>
<a name="l00615"></a>00615 <span class="comment">         * </span>
<a name="l00616"></a>00616 <span class="comment">         * Renames a bucket by making a copy and deleting the original.</span>
<a name="l00617"></a>00617 <span class="comment">         * </span>
<a name="l00618"></a>00618 <span class="comment">         * @access public</span>
<a name="l00619"></a>00619 <span class="comment">         * @param string $source_bucket (Required) The name of the source bucket.</span>
<a name="l00620"></a>00620 <span class="comment">         * @param string $dest_bucket (Required) The name of the destination bucket.</span>
<a name="l00621"></a>00621 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00622"></a>00622 <span class="comment">         * @section example Example Usage:</span>
<a name="l00623"></a>00623 <span class="comment">         * @include s3/rename_bucket.phps</span>
<a name="l00624"></a>00624 <span class="comment">         */</span>
<a name="l00625"></a><a class="code" href="a00003_3e4193ca93e91198b77b5911053a0fa5.html#3e4193ca93e91198b77b5911053a0fa5">00625</a>         <span class="keyword">public</span> function <a class="code" href="a00003_3e4193ca93e91198b77b5911053a0fa5.html#3e4193ca93e91198b77b5911053a0fa5">rename_bucket</a>($source_bucket, $dest_bucket)
<a name="l00626"></a>00626         {
<a name="l00627"></a>00627                 $responses = array();
<a name="l00628"></a>00628                 $responses[<span class="stringliteral">'copy'</span>] = $this-&gt;<a class="code" href="a00003_1fa4f66eebde9030b61e55a5c3f7b91b.html#1fa4f66eebde9030b61e55a5c3f7b91b">copy_bucket</a>($source_bucket, $dest_bucket);
<a name="l00629"></a>00629                 $responses[<span class="stringliteral">'delete'</span>] = $this-&gt;<a class="code" href="a00003_c4773c6d6a161c0baef522c4f47eca16.html#c4773c6d6a161c0baef522c4f47eca16">delete_bucket</a>($source_bucket, <span class="keyword">true</span>);
<a name="l00630"></a>00630 
<a name="l00631"></a>00631                 <span class="keywordflow">return</span> $responses;
<a name="l00632"></a>00632         }
<a name="l00633"></a>00633 <span class="comment"></span>
<a name="l00634"></a>00634 <span class="comment">        /**</span>
<a name="l00635"></a>00635 <span class="comment">         * Get Bucket Size</span>
<a name="l00636"></a>00636 <span class="comment">         * </span>
<a name="l00637"></a>00637 <span class="comment">         * Gets the number of files in the bucket.</span>
<a name="l00638"></a>00638 <span class="comment">         * </span>
<a name="l00639"></a>00639 <span class="comment">         * @access public</span>
<a name="l00640"></a>00640 <span class="comment">         * @param string $bucket (Required) The name of the bucket to check.</span>
<a name="l00641"></a>00641 <span class="comment">         * @return integer The number of files in the bucket.</span>
<a name="l00642"></a>00642 <span class="comment">         * @section example Example Usage:</span>
<a name="l00643"></a>00643 <span class="comment">         * @include s3/get_bucket_size.phps</span>
<a name="l00644"></a>00644 <span class="comment">         */</span>
<a name="l00645"></a><a class="code" href="a00003_3871abbdd8d54892dd2fa7f8ddd130d5.html#3871abbdd8d54892dd2fa7f8ddd130d5">00645</a>         <span class="keyword">public</span> function <a class="code" href="a00003_3871abbdd8d54892dd2fa7f8ddd130d5.html#3871abbdd8d54892dd2fa7f8ddd130d5">get_bucket_size</a>($bucket)
<a name="l00646"></a>00646         {
<a name="l00647"></a>00647                 <span class="keywordflow">return</span> count($this-&gt;<a class="code" href="a00003_58758d28b2b11c5a98c635c34092f7be.html#58758d28b2b11c5a98c635c34092f7be">get_object_list</a>($bucket));
<a name="l00648"></a>00648         }
<a name="l00649"></a>00649 <span class="comment"></span>
<a name="l00650"></a>00650 <span class="comment">        /**</span>
<a name="l00651"></a>00651 <span class="comment">         * Get Bucket File Size</span>
<a name="l00652"></a>00652 <span class="comment">         * </span>
<a name="l00653"></a>00653 <span class="comment">         * Gets the file size of the contents of the bucket.</span>
<a name="l00654"></a>00654 <span class="comment">         * </span>
<a name="l00655"></a>00655 <span class="comment">         * @access public</span>
<a name="l00656"></a>00656 <span class="comment">         * @param string $bucket (Required) The name of the bucket to check.</span>
<a name="l00657"></a>00657 <span class="comment">         * @param boolean $friendly_format (Optional) Whether to format the value to 2 decimal points using the largest possible unit (i.e. 3.42 GB).</span>
<a name="l00658"></a>00658 <span class="comment">         * @return integer|string The number of bytes as an integer, or the friendly format as a string.</span>
<a name="l00659"></a>00659 <span class="comment">         * @section example Example Usage:</span>
<a name="l00660"></a>00660 <span class="comment">         * @include s3/get_bucket_filesize.phps</span>
<a name="l00661"></a>00661 <span class="comment">         */</span>
<a name="l00662"></a><a class="code" href="a00003_170c2e321cca665bb36e771a908141dd.html#170c2e321cca665bb36e771a908141dd">00662</a>         <span class="keyword">public</span> function <a class="code" href="a00003_170c2e321cca665bb36e771a908141dd.html#170c2e321cca665bb36e771a908141dd">get_bucket_filesize</a>($bucket, $friendly_format = <span class="keyword">false</span>)
<a name="l00663"></a>00663         {
<a name="l00664"></a>00664                 $filesize = 0;
<a name="l00665"></a>00665                 $list = $this-&gt;<a class="code" href="a00003_db502170660cf3cd5d19b337bfbc8382.html#db502170660cf3cd5d19b337bfbc8382">list_objects</a>($bucket);
<a name="l00666"></a>00666 
<a name="l00667"></a>00667                 <span class="keywordflow">foreach</span> ($list-&gt;body-&gt;Contents as $filename)
<a name="l00668"></a>00668                 {
<a name="l00669"></a>00669                         $filesize += (int) $filename-&gt;Size;
<a name="l00670"></a>00670                 }
<a name="l00671"></a>00671 
<a name="l00672"></a>00672                 <span class="keywordflow">if</span> ($friendly_format)
<a name="l00673"></a>00673                 {
<a name="l00674"></a>00674                         $filesize = $this-&gt;util-&gt;size_readable($filesize);
<a name="l00675"></a>00675                 }
<a name="l00676"></a>00676 
<a name="l00677"></a>00677                 <span class="keywordflow">return</span> $filesize;
<a name="l00678"></a>00678         }
<a name="l00679"></a>00679 <span class="comment"></span>
<a name="l00680"></a>00680 <span class="comment">        /**</span>
<a name="l00681"></a>00681 <span class="comment">         * List Buckets</span>
<a name="l00682"></a>00682 <span class="comment">         * </span>
<a name="l00683"></a>00683 <span class="comment">         * Gets a list of all of the buckets on the S3 account.</span>
<a name="l00684"></a>00684 <span class="comment">         * </span>
<a name="l00685"></a>00685 <span class="comment">         * @access public</span>
<a name="l00686"></a>00686 <span class="comment">         * @param boolean $returnCurlHandle (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.</span>
<a name="l00687"></a>00687 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00688"></a>00688 <span class="comment">         * @section example Example Usage:</span>
<a name="l00689"></a>00689 <span class="comment">         * @include s3/list_buckets.phps</span>
<a name="l00690"></a>00690 <span class="comment">         */</span>
<a name="l00691"></a><a class="code" href="a00003_56b297c1c80ff878da36ef1fa868c38f.html#56b297c1c80ff878da36ef1fa868c38f">00691</a>         <span class="keyword">public</span> function <a class="code" href="a00003_56b297c1c80ff878da36ef1fa868c38f.html#56b297c1c80ff878da36ef1fa868c38f">list_buckets</a>($returnCurlHandle = null)
<a name="l00692"></a>00692         {
<a name="l00693"></a>00693                 <span class="comment">// Add this to our request</span>
<a name="l00694"></a>00694                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_bee436b68fa82c549b1067404e0c33fe.html#bee436b68fa82c549b1067404e0c33fe">HTTP_GET</a>;
<a name="l00695"></a>00695                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'list_buckets'</span>;
<a name="l00696"></a>00696                 $opt[<span class="stringliteral">'returnCurlHandle'</span>] = $returnCurlHandle;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698                 <span class="comment">// Authenticate to S3</span>
<a name="l00699"></a>00699                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>(<span class="stringliteral">''</span>, $opt);
<a name="l00700"></a>00700         }
<a name="l00701"></a>00701 <span class="comment"></span>
<a name="l00702"></a>00702 <span class="comment">        /**</span>
<a name="l00703"></a>00703 <span class="comment">         * Get Bucket List</span>
<a name="l00704"></a>00704 <span class="comment">         * </span>
<a name="l00705"></a>00705 <span class="comment">         * ONLY lists the bucket names on the S3 account.</span>
<a name="l00706"></a>00706 <span class="comment">         * </span>
<a name="l00707"></a>00707 <span class="comment">         * @access public</span>
<a name="l00708"></a>00708 <span class="comment">         * @param string $pcre (Optional) A Perl-Compatible Regular Expression (PCRE) to filter the bucket names against.</span>
<a name="l00709"></a>00709 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00710"></a>00710 <span class="comment">         * @section example Example Usage:</span>
<a name="l00711"></a>00711 <span class="comment">         * @include s3/get_bucket_list.phps</span>
<a name="l00712"></a>00712 <span class="comment">         */</span>
<a name="l00713"></a><a class="code" href="a00003_8dbb0782f98218849d44204c9c6d4a2a.html#8dbb0782f98218849d44204c9c6d4a2a">00713</a>         <span class="keyword">public</span> function <a class="code" href="a00003_8dbb0782f98218849d44204c9c6d4a2a.html#8dbb0782f98218849d44204c9c6d4a2a">get_bucket_list</a>($pcre = null)
<a name="l00714"></a>00714         {
<a name="l00715"></a>00715                 <span class="comment">// Set some default values</span>
<a name="l00716"></a>00716                 $bucketnames = array();
<a name="l00717"></a>00717 
<a name="l00718"></a>00718                 <span class="comment">// Get a list of buckets.</span>
<a name="l00719"></a>00719                 $list = $this-&gt;<a class="code" href="a00003_56b297c1c80ff878da36ef1fa868c38f.html#56b297c1c80ff878da36ef1fa868c38f">list_buckets</a>();
<a name="l00720"></a>00720 
<a name="l00721"></a>00721                 <span class="comment">// If we have a PCRE regex, store it.</span>
<a name="l00722"></a>00722                 <span class="keywordflow">if</span> ($pcre)
<a name="l00723"></a>00723                 {
<a name="l00724"></a>00724                         <span class="comment">// Loop through and find the bucket names.</span>
<a name="l00725"></a>00725                         <span class="keywordflow">foreach</span> ($list-&gt;body-&gt;Buckets-&gt;Bucket as $bucket)
<a name="l00726"></a>00726                         {
<a name="l00727"></a>00727                                 $bucket = (string) $bucket-&gt;Name;
<a name="l00728"></a>00728 
<a name="l00729"></a>00729                                 <span class="keywordflow">if</span> (preg_match($pcre, $bucket))
<a name="l00730"></a>00730                                 {
<a name="l00731"></a>00731                                         $bucketnames[] = $bucket;
<a name="l00732"></a>00732                                 }
<a name="l00733"></a>00733                         }
<a name="l00734"></a>00734                 }
<a name="l00735"></a>00735                 <span class="keywordflow">else</span>
<a name="l00736"></a>00736                 {
<a name="l00737"></a>00737                         <span class="comment">// Loop through and find the bucket names.</span>
<a name="l00738"></a>00738                         <span class="keywordflow">foreach</span> ($list-&gt;body-&gt;Buckets-&gt;Bucket as $bucket)
<a name="l00739"></a>00739                         {
<a name="l00740"></a>00740                                 $bucketnames[] = (string) $bucket-&gt;Name;
<a name="l00741"></a>00741                         }
<a name="l00742"></a>00742                 }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744                 <span class="keywordflow">return</span> (count($bucketnames) &gt; 0) ? $bucketnames : null;
<a name="l00745"></a>00745         }
<a name="l00746"></a>00746 <span class="comment"></span>
<a name="l00747"></a>00747 <span class="comment">        /**</span>
<a name="l00748"></a>00748 <span class="comment">         * Get Bucket ACL</span>
<a name="l00749"></a>00749 <span class="comment">         * </span>
<a name="l00750"></a>00750 <span class="comment">         * Gets the ACL settings for a bucket.</span>
<a name="l00751"></a>00751 <span class="comment">         * </span>
<a name="l00752"></a>00752 <span class="comment">         * @access public</span>
<a name="l00753"></a>00753 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used.</span>
<a name="l00754"></a>00754 <span class="comment">         * @param boolean $returnCurlHandle (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.</span>
<a name="l00755"></a>00755 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00756"></a>00756 <span class="comment">         * @section example Example Usage:</span>
<a name="l00757"></a>00757 <span class="comment">         * @include s3/get_bucket_acl.phps</span>
<a name="l00758"></a>00758 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?RESTAccessPolicy.html</span>
<a name="l00759"></a>00759 <span class="comment">         */</span>
<a name="l00760"></a><a class="code" href="a00003_6312ae42a9d57aba65a54fe72f524a83.html#6312ae42a9d57aba65a54fe72f524a83">00760</a>         <span class="keyword">public</span> function <a class="code" href="a00003_6312ae42a9d57aba65a54fe72f524a83.html#6312ae42a9d57aba65a54fe72f524a83">get_bucket_acl</a>($bucket, $returnCurlHandle = null)
<a name="l00761"></a>00761         {
<a name="l00762"></a>00762                 <span class="comment">// Add this to our request</span>
<a name="l00763"></a>00763                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_bee436b68fa82c549b1067404e0c33fe.html#bee436b68fa82c549b1067404e0c33fe">HTTP_GET</a>;
<a name="l00764"></a>00764                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'get_bucket_acl'</span>;
<a name="l00765"></a>00765                 $opt[<span class="stringliteral">'returnCurlHandle'</span>] = $returnCurlHandle;
<a name="l00766"></a>00766 
<a name="l00767"></a>00767                 <span class="comment">// Authenticate to S3</span>
<a name="l00768"></a>00768                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l00769"></a>00769         }
<a name="l00770"></a>00770 <span class="comment"></span>
<a name="l00771"></a>00771 <span class="comment">        /**</span>
<a name="l00772"></a>00772 <span class="comment">         * Set Bucket ACL</span>
<a name="l00773"></a>00773 <span class="comment">         * </span>
<a name="l00774"></a>00774 <span class="comment">         * Sets the ACL settings for a bucket.</span>
<a name="l00775"></a>00775 <span class="comment">         * </span>
<a name="l00776"></a>00776 <span class="comment">         * @access public</span>
<a name="l00777"></a>00777 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used.</span>
<a name="l00778"></a>00778 <span class="comment">         * @param boolean $returnCurlHandle (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.</span>
<a name="l00779"></a>00779 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00780"></a>00780 <span class="comment">         * @section example Example Usage:</span>
<a name="l00781"></a>00781 <span class="comment">         * @include s3/set_bucket_acl.phps</span>
<a name="l00782"></a>00782 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?RESTAccessPolicy.html</span>
<a name="l00783"></a>00783 <span class="comment">         */</span>
<a name="l00784"></a><a class="code" href="a00003_8ec09395f69ddde158eb75d790bf839c.html#8ec09395f69ddde158eb75d790bf839c">00784</a>         <span class="keyword">public</span> function <a class="code" href="a00003_8ec09395f69ddde158eb75d790bf839c.html#8ec09395f69ddde158eb75d790bf839c">set_bucket_acl</a>($bucket, $acl = <a class="code" href="a00017_26b272ddfab8427eac3d883fb4f0356f.html#26b272ddfab8427eac3d883fb4f0356f">S3_ACL_PRIVATE</a>, $returnCurlHandle = null)
<a name="l00785"></a>00785         {
<a name="l00786"></a>00786                 <span class="comment">// Add this to our request</span>
<a name="l00787"></a>00787                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_12f047cd6da4c2ebf4f768664dfc8cb8.html#12f047cd6da4c2ebf4f768664dfc8cb8">HTTP_PUT</a>;
<a name="l00788"></a>00788                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'set_bucket_acl'</span>;
<a name="l00789"></a>00789                 $opt[<span class="stringliteral">'returnCurlHandle'</span>] = $returnCurlHandle;
<a name="l00790"></a>00790                 $opt[<span class="stringliteral">'acl'</span>] = $acl;
<a name="l00791"></a>00791 
<a name="l00792"></a>00792                 <span class="comment">// Authenticate to S3</span>
<a name="l00793"></a>00793                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l00794"></a>00794         }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 
<a name="l00797"></a>00797         <span class="comment">/*%******************************************************************************************%*/</span>
<a name="l00798"></a>00798         <span class="comment">// OBJECT METHODS</span>
<a name="l00799"></a>00799 <span class="comment"></span>
<a name="l00800"></a>00800 <span class="comment">        /**</span>
<a name="l00801"></a>00801 <span class="comment">         * Create Object</span>
<a name="l00802"></a>00802 <span class="comment">         *</span>
<a name="l00803"></a>00803 <span class="comment">         * Once you have a bucket, you can start storing objects in it. Objects are stored using the HTTP </span>
<a name="l00804"></a>00804 <span class="comment">         * PUT method. Each object can hold up to 5 GB of data. When you store an object, S3 streams the </span>
<a name="l00805"></a>00805 <span class="comment">         * data to multiple storage servers in multiple data centers to ensure that the data remains </span>
<a name="l00806"></a>00806 <span class="comment">         * available in the event of internal network or hardware failure.</span>
<a name="l00807"></a>00807 <span class="comment">         *</span>
<a name="l00808"></a>00808 <span class="comment">         * @access public</span>
<a name="l00809"></a>00809 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used.</span>
<a name="l00810"></a>00810 <span class="comment">         * @param array $opt (Required) Associative array of parameters which can have the following keys:</span>
<a name="l00811"></a>00811 <span class="comment">         * &lt;ul&gt;</span>
<a name="l00812"></a>00812 <span class="comment">         *   &lt;li&gt;string filename - (Required) The filename for the content.&lt;/li&gt;</span>
<a name="l00813"></a>00813 <span class="comment">         *   &lt;li&gt;string body - (Required) The data to be stored in the object.&lt;/li&gt;</span>
<a name="l00814"></a>00814 <span class="comment">         *   &lt;li&gt;string contentType - (Required) The type of content that is being sent in the body.&lt;/li&gt;</span>
<a name="l00815"></a>00815 <span class="comment">         *   &lt;li&gt;string acl - (Optional) One of the following options: S3_ACL_PRIVATE, S3_ACL_PUBLIC, S3_ACL_OPEN, or S3_ACL_AUTH_READ. Defaults to S3_ACL_PRIVATE.&lt;/li&gt;</span>
<a name="l00816"></a>00816 <span class="comment">         *   &lt;li&gt;boolean $returnCurlHandle - (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.&lt;/li&gt;</span>
<a name="l00817"></a>00817 <span class="comment">         *   &lt;li&gt;array meta - (Optional) Associative array of key-value pairs. Represented by x-amz-meta-: Any header starting with this prefix is considered user metadata. It will be stored with the object and returned when you retrieve the object. The total size of the HTTP request, not including the body, must be less than 4 KB.&lt;/li&gt;</span>
<a name="l00818"></a>00818 <span class="comment">         * &lt;/ul&gt;</span>
<a name="l00819"></a>00819 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00820"></a>00820 <span class="comment">         * @section example Example Usage:</span>
<a name="l00821"></a>00821 <span class="comment">         * @include s3/create_object.phps</span>
<a name="l00822"></a>00822 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/RESTObjectPUT.html</span>
<a name="l00823"></a>00823 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/RESTAccessPolicy.html</span>
<a name="l00824"></a>00824 <span class="comment">         */</span>
<a name="l00825"></a><a class="code" href="a00003_573980f90cc214e190d74a2de0010492.html#573980f90cc214e190d74a2de0010492">00825</a>         <span class="keyword">public</span> function <a class="code" href="a00003_573980f90cc214e190d74a2de0010492.html#573980f90cc214e190d74a2de0010492">create_object</a>($bucket, $opt = null)
<a name="l00826"></a>00826         {
<a name="l00827"></a>00827                 <span class="comment">// Add this to our request</span>
<a name="l00828"></a>00828                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_12f047cd6da4c2ebf4f768664dfc8cb8.html#12f047cd6da4c2ebf4f768664dfc8cb8">HTTP_PUT</a>;
<a name="l00829"></a>00829                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'create_object'</span>;
<a name="l00830"></a>00830                 $opt[<span class="stringliteral">'filename'</span>] = rawurlencode($opt[<span class="stringliteral">'filename'</span>]);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832                 <span class="comment">// Authenticate to S3</span>
<a name="l00833"></a>00833                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l00834"></a>00834         }
<a name="l00835"></a>00835 <span class="comment"></span>
<a name="l00836"></a>00836 <span class="comment">        /**</span>
<a name="l00837"></a>00837 <span class="comment">         * Get Object</span>
<a name="l00838"></a>00838 <span class="comment">         * </span>
<a name="l00839"></a>00839 <span class="comment">         * Reads the contents of an object within a bucket.</span>
<a name="l00840"></a>00840 <span class="comment">         *</span>
<a name="l00841"></a>00841 <span class="comment">         * @access public</span>
<a name="l00842"></a>00842 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used.</span>
<a name="l00843"></a>00843 <span class="comment">         * @param string $filename (Required) The filename for the content.</span>
<a name="l00844"></a>00844 <span class="comment">         * @param array $opt (Optional) Associative array of parameters which can have the following keys:</span>
<a name="l00845"></a>00845 <span class="comment">         * &lt;ul&gt;</span>
<a name="l00846"></a>00846 <span class="comment">         *   &lt;li&gt;string lastmodified - (Optional) The LastModified header passed in from a previous request. If used, requires 'etag' as well. Will return a 304 if file hasn't changed.&lt;/li&gt;</span>
<a name="l00847"></a>00847 <span class="comment">         *   &lt;li&gt;string etag - (Optional) The ETag header passed in from a previous request. If used, requires 'lastmodified' as well. Will return a 304 if file hasn't changed.&lt;/li&gt;</span>
<a name="l00848"></a>00848 <span class="comment">         *   &lt;li&gt;boolean $returnCurlHandle - (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.&lt;/li&gt;</span>
<a name="l00849"></a>00849 <span class="comment">         *   &lt;li&gt;string $range - (Optional) A range of bytes to fetch from the file. Useful for downloading partial bits or completing incomplete files. Range notated with a hyphen (e.g. 0-10485759). Defaults to the complete file.</span>
<a name="l00850"></a>00850 <span class="comment">         * &lt;/ul&gt;</span>
<a name="l00851"></a>00851 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00852"></a>00852 <span class="comment">         * @section example Example Usage:</span>
<a name="l00853"></a>00853 <span class="comment">         * @include s3/get_object.phps</span>
<a name="l00854"></a>00854 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/RESTObjectGET.html</span>
<a name="l00855"></a>00855 <span class="comment">         */</span>
<a name="l00856"></a><a class="code" href="a00003_c910dc680460ad26d60cd9d138c3e534.html#c910dc680460ad26d60cd9d138c3e534">00856</a>         <span class="keyword">public</span> function <a class="code" href="a00003_c910dc680460ad26d60cd9d138c3e534.html#c910dc680460ad26d60cd9d138c3e534">get_object</a>($bucket, $filename, $opt = null)
<a name="l00857"></a>00857         {
<a name="l00858"></a>00858                 <span class="comment">// Add this to our request</span>
<a name="l00859"></a>00859                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_bee436b68fa82c549b1067404e0c33fe.html#bee436b68fa82c549b1067404e0c33fe">HTTP_GET</a>;
<a name="l00860"></a>00860                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'get_object'</span>;
<a name="l00861"></a>00861                 $opt[<span class="stringliteral">'filename'</span>] = rawurlencode($filename);
<a name="l00862"></a>00862 
<a name="l00863"></a>00863                 <span class="comment">// Authenticate to S3</span>
<a name="l00864"></a>00864                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l00865"></a>00865         }
<a name="l00866"></a>00866 <span class="comment"></span>
<a name="l00867"></a>00867 <span class="comment">        /**</span>
<a name="l00868"></a>00868 <span class="comment">         * HEAD Object</span>
<a name="l00869"></a>00869 <span class="comment">         * </span>
<a name="l00870"></a>00870 <span class="comment">         * Reads only the HTTP headers of an object within a bucket.</span>
<a name="l00871"></a>00871 <span class="comment">         *</span>
<a name="l00872"></a>00872 <span class="comment">         * @access public</span>
<a name="l00873"></a>00873 <span class="comment">         * @param string $bucket (Required) The name of the bucket check.</span>
<a name="l00874"></a>00874 <span class="comment">         * @param string $filename (Required) The filename for the content.</span>
<a name="l00875"></a>00875 <span class="comment">         * @param boolean $returnCurlHandle (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.</span>
<a name="l00876"></a>00876 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00877"></a>00877 <span class="comment">         * @section example Example Usage:</span>
<a name="l00878"></a>00878 <span class="comment">         * @include s3/head_object.phps</span>
<a name="l00879"></a>00879 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/RESTObjectHEAD.html</span>
<a name="l00880"></a>00880 <span class="comment">         */</span>
<a name="l00881"></a><a class="code" href="a00003_d6600356585a48f822674ccadde146c8.html#d6600356585a48f822674ccadde146c8">00881</a>         <span class="keyword">public</span> function <a class="code" href="a00003_d6600356585a48f822674ccadde146c8.html#d6600356585a48f822674ccadde146c8">head_object</a>($bucket, $filename, $returnCurlHandle = null)
<a name="l00882"></a>00882         {
<a name="l00883"></a>00883                 <span class="comment">// Add this to our request</span>
<a name="l00884"></a>00884                 $opt = array();
<a name="l00885"></a>00885                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_f1c93e1abfb608f9d2c35759ae2d62e9.html#f1c93e1abfb608f9d2c35759ae2d62e9">HTTP_HEAD</a>;
<a name="l00886"></a>00886                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'head_object'</span>;
<a name="l00887"></a>00887                 $opt[<span class="stringliteral">'filename'</span>] = rawurlencode($filename);
<a name="l00888"></a>00888                 $opt[<span class="stringliteral">'returnCurlHandle'</span>] = $returnCurlHandle;
<a name="l00889"></a>00889 
<a name="l00890"></a>00890                 <span class="comment">// Authenticate to S3</span>
<a name="l00891"></a>00891                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l00892"></a>00892         }
<a name="l00893"></a>00893 <span class="comment"></span>
<a name="l00894"></a>00894 <span class="comment">        /**</span>
<a name="l00895"></a>00895 <span class="comment">         * If Object Exists</span>
<a name="l00896"></a>00896 <span class="comment">         * </span>
<a name="l00897"></a>00897 <span class="comment">         * Checks whether this object already exists in this bucket.</span>
<a name="l00898"></a>00898 <span class="comment">         * </span>
<a name="l00899"></a>00899 <span class="comment">         * @access public</span>
<a name="l00900"></a>00900 <span class="comment">         * @param string $bucket (Required) The name of the bucket check.</span>
<a name="l00901"></a>00901 <span class="comment">         * @param string $filename (Required) The filename for the content.</span>
<a name="l00902"></a>00902 <span class="comment">         * @return boolean Whether it exists or not.</span>
<a name="l00903"></a>00903 <span class="comment">         * @section example Example Usage:</span>
<a name="l00904"></a>00904 <span class="comment">         * @include s3/if_object_exists.phps</span>
<a name="l00905"></a>00905 <span class="comment">         */</span>
<a name="l00906"></a><a class="code" href="a00003_655832691ee2eb3b7c7e72f8e7758bb8.html#655832691ee2eb3b7c7e72f8e7758bb8">00906</a>         <span class="keyword">public</span> function <a class="code" href="a00003_655832691ee2eb3b7c7e72f8e7758bb8.html#655832691ee2eb3b7c7e72f8e7758bb8">if_object_exists</a>($bucket, $filename)
<a name="l00907"></a>00907         {
<a name="l00908"></a>00908                 $header = $this-&gt;<a class="code" href="a00003_d6600356585a48f822674ccadde146c8.html#d6600356585a48f822674ccadde146c8">head_object</a>($bucket, $filename);
<a name="l00909"></a>00909                 <span class="keywordflow">return</span> $header-&gt;isOK();
<a name="l00910"></a>00910         }
<a name="l00911"></a>00911 <span class="comment"></span>
<a name="l00912"></a>00912 <span class="comment">        /**</span>
<a name="l00913"></a>00913 <span class="comment">         * Delete Object</span>
<a name="l00914"></a>00914 <span class="comment">         * </span>
<a name="l00915"></a>00915 <span class="comment">         * Deletes an object within a bucket.</span>
<a name="l00916"></a>00916 <span class="comment">         *</span>
<a name="l00917"></a>00917 <span class="comment">         * @access public</span>
<a name="l00918"></a>00918 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used.</span>
<a name="l00919"></a>00919 <span class="comment">         * @param string $filename (Required) The filename you want to delete.</span>
<a name="l00920"></a>00920 <span class="comment">         * @param boolean $returnCurlHandle (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.</span>
<a name="l00921"></a>00921 <span class="comment">         * @return TarzanHTTPResponse Standard TarzanHTTPResponse.</span>
<a name="l00922"></a>00922 <span class="comment">         * @section example Example Usage:</span>
<a name="l00923"></a>00923 <span class="comment">         * @include s3/delete_object.phps</span>
<a name="l00924"></a>00924 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/RESTObjectDELETE.html</span>
<a name="l00925"></a>00925 <span class="comment">         */</span>
<a name="l00926"></a><a class="code" href="a00003_22a2cc306d129bb28032d38d0774950c.html#22a2cc306d129bb28032d38d0774950c">00926</a>         <span class="keyword">public</span> function <a class="code" href="a00003_22a2cc306d129bb28032d38d0774950c.html#22a2cc306d129bb28032d38d0774950c">delete_object</a>($bucket, $filename, $returnCurlHandle = null)
<a name="l00927"></a>00927         {
<a name="l00928"></a>00928                 <span class="comment">// Add this to our request</span>
<a name="l00929"></a>00929                 $opt = array();
<a name="l00930"></a>00930                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_7c0802f4bae424cd442b2086c5859495.html#7c0802f4bae424cd442b2086c5859495">HTTP_DELETE</a>;
<a name="l00931"></a>00931                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'delete_object'</span>;
<a name="l00932"></a>00932                 $opt[<span class="stringliteral">'filename'</span>] = rawurlencode($filename);
<a name="l00933"></a>00933                 $opt[<span class="stringliteral">'returnCurlHandle'</span>] = $returnCurlHandle;
<a name="l00934"></a>00934 
<a name="l00935"></a>00935                 <span class="comment">// Authenticate to S3</span>
<a name="l00936"></a>00936                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l00937"></a>00937         }
<a name="l00938"></a>00938 <span class="comment"></span>
<a name="l00939"></a>00939 <span class="comment">        /**</span>
<a name="l00940"></a>00940 <span class="comment">         * Delete All Objects</span>
<a name="l00941"></a>00941 <span class="comment">         * </span>
<a name="l00942"></a>00942 <span class="comment">         * Delete all of the objects inside the specified bucket.</span>
<a name="l00943"></a>00943 <span class="comment">         *</span>
<a name="l00944"></a>00944 <span class="comment">         * @access public</span>
<a name="l00945"></a>00945 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used.</span>
<a name="l00946"></a>00946 <span class="comment">         * @param string $pcre (Optional) PCRE regular expression to match filenames by. Defaults to S3_PCRE_ALL.</span>
<a name="l00947"></a>00947 <span class="comment">         * @return boolean Determines the success of deleting all files.</span>
<a name="l00948"></a>00948 <span class="comment">         * @section example Example Usage:</span>
<a name="l00949"></a>00949 <span class="comment">         * @include s3/delete_all_objects.phps</span>
<a name="l00950"></a>00950 <span class="comment">         * @see delete_object</span>
<a name="l00951"></a>00951 <span class="comment">         */</span>
<a name="l00952"></a><a class="code" href="a00003_1e9648947ae7ab9f3842d430125b23c9.html#1e9648947ae7ab9f3842d430125b23c9">00952</a>         <span class="keyword">public</span> function <a class="code" href="a00003_1e9648947ae7ab9f3842d430125b23c9.html#1e9648947ae7ab9f3842d430125b23c9">delete_all_objects</a>($bucket, $pcre = <a class="code" href="a00017_3a75518673c949b49359471ce7293d28.html#3a75518673c949b49359471ce7293d28">S3_PCRE_ALL</a>)
<a name="l00953"></a>00953         {
<a name="l00954"></a>00954                 <span class="comment">// Collect all matches</span>
<a name="l00955"></a>00955                 $list = $this-&gt;<a class="code" href="a00003_58758d28b2b11c5a98c635c34092f7be.html#58758d28b2b11c5a98c635c34092f7be">get_object_list</a>($bucket, array(<span class="stringliteral">'pcre'</span>, $pcre));
<a name="l00956"></a>00956 
<a name="l00957"></a>00957                 <span class="comment">// As long as we have at least one match...</span>
<a name="l00958"></a>00958                 <span class="keywordflow">if</span> (count($list) &gt; 0)
<a name="l00959"></a>00959                 {
<a name="l00960"></a>00960                         <span class="comment">// Hold CURL handles</span>
<a name="l00961"></a>00961                         $handles = array();
<a name="l00962"></a>00962 
<a name="l00963"></a>00963                         <span class="comment">// Go through all of the items and delete them.</span>
<a name="l00964"></a>00964                         <span class="keywordflow">foreach</span> ($list as $item)
<a name="l00965"></a>00965                         {
<a name="l00966"></a>00966                                 $handles[] = $this-&gt;<a class="code" href="a00003_22a2cc306d129bb28032d38d0774950c.html#22a2cc306d129bb28032d38d0774950c">delete_object</a>($bucket, $item, <span class="keyword">true</span>);
<a name="l00967"></a>00967                         }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969                         $request = <span class="keyword">new</span> $this-&gt;request_class(null);
<a name="l00970"></a>00970                         <span class="keywordflow">return</span> $request-&gt;sendMultiRequest($handles);
<a name="l00971"></a>00971                 }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00974"></a>00974         }
<a name="l00975"></a>00975 <span class="comment"></span>
<a name="l00976"></a>00976 <span class="comment">        /**</span>
<a name="l00977"></a>00977 <span class="comment">         * List Objects</span>
<a name="l00978"></a>00978 <span class="comment">         * </span>
<a name="l00979"></a>00979 <span class="comment">         * Lists the objects in a bucket. Provided as the 'GetBucket' action in Amazon's REST API.</span>
<a name="l00980"></a>00980 <span class="comment">         *</span>
<a name="l00981"></a>00981 <span class="comment">         * @access public</span>
<a name="l00982"></a>00982 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used.</span>
<a name="l00983"></a>00983 <span class="comment">         * @param array $opt (Optional) Associative array of parameters which can have the following keys:</span>
<a name="l00984"></a>00984 <span class="comment">         * &lt;ul&gt;</span>
<a name="l00985"></a>00985 <span class="comment">         *   &lt;li&gt;string prefix - (Optional) Restricts the response to only contain results that begin with the specified prefix.&lt;/li&gt;</span>
<a name="l00986"></a>00986 <span class="comment">         *   &lt;li&gt;string marker - (Optional) It restricts the response to only contain results that occur alphabetically after the value of marker.&lt;/li&gt;</span>
<a name="l00987"></a>00987 <span class="comment">         *   &lt;li&gt;string maxKeys - (Optional) Limits the number of results returned in response to your query. Will return no more than this number of results, but possibly less.&lt;/li&gt;</span>
<a name="l00988"></a>00988 <span class="comment">         *   &lt;li&gt;string delimiter - (Optional) Unicode string parameter. Keys that contain the same string between the prefix and the first occurrence of the delimiter will be rolled up into a single result element in the CommonPrefixes collection.&lt;/li&gt;</span>
<a name="l00989"></a>00989 <span class="comment">         *   &lt;li&gt;boolean $returnCurlHandle - (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.&lt;/li&gt;</span>
<a name="l00990"></a>00990 <span class="comment">         * &lt;/ul&gt;</span>
<a name="l00991"></a>00991 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l00992"></a>00992 <span class="comment">         * @section example Example Usage:</span>
<a name="l00993"></a>00993 <span class="comment">         * @include s3/list_objects.phps</span>
<a name="l00994"></a>00994 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/gsg/ListKeys.html</span>
<a name="l00995"></a>00995 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/ListingKeysRequest.html</span>
<a name="l00996"></a>00996 <span class="comment">         */</span>
<a name="l00997"></a><a class="code" href="a00003_db502170660cf3cd5d19b337bfbc8382.html#db502170660cf3cd5d19b337bfbc8382">00997</a>         <span class="keyword">public</span> function <a class="code" href="a00003_db502170660cf3cd5d19b337bfbc8382.html#db502170660cf3cd5d19b337bfbc8382">list_objects</a>($bucket, $opt = null)
<a name="l00998"></a>00998         {
<a name="l00999"></a>00999                 <span class="comment">// Add this to our request</span>
<a name="l01000"></a>01000                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_bee436b68fa82c549b1067404e0c33fe.html#bee436b68fa82c549b1067404e0c33fe">HTTP_GET</a>;
<a name="l01001"></a>01001                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'list_objects'</span>;
<a name="l01002"></a>01002 
<a name="l01003"></a>01003                 <span class="comment">// Authenticate to S3</span>
<a name="l01004"></a>01004                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l01005"></a>01005         }
<a name="l01006"></a>01006 <span class="comment"></span>
<a name="l01007"></a>01007 <span class="comment">        /**</span>
<a name="l01008"></a>01008 <span class="comment">         * Get Object File Size</span>
<a name="l01009"></a>01009 <span class="comment">         * </span>
<a name="l01010"></a>01010 <span class="comment">         * Gets the file size of the object.</span>
<a name="l01011"></a>01011 <span class="comment">         * </span>
<a name="l01012"></a>01012 <span class="comment">         * @access public</span>
<a name="l01013"></a>01013 <span class="comment">         * @param string $bucket (Required) The name of the bucket check.</span>
<a name="l01014"></a>01014 <span class="comment">         * @param string $filename (Required) The filename for the content.</span>
<a name="l01015"></a>01015 <span class="comment">         * @param boolean $friendly_format (Optional) Whether to format the value to 2 decimal points using the largest possible unit (i.e. 3.42 GB).</span>
<a name="l01016"></a>01016 <span class="comment">         * @return integer|string The number of bytes as an integer, or the friendly format as a string.</span>
<a name="l01017"></a>01017 <span class="comment">         * @section example Example Usage:</span>
<a name="l01018"></a>01018 <span class="comment">         * @include s3/get_object_filesize.phps</span>
<a name="l01019"></a>01019 <span class="comment">         */</span>
<a name="l01020"></a><a class="code" href="a00003_ff528738510994a60a46e97a0d804cc0.html#ff528738510994a60a46e97a0d804cc0">01020</a>         <span class="keyword">public</span> function <a class="code" href="a00003_ff528738510994a60a46e97a0d804cc0.html#ff528738510994a60a46e97a0d804cc0">get_object_filesize</a>($bucket, $filename, $friendly_format = <span class="keyword">false</span>)
<a name="l01021"></a>01021         {
<a name="l01022"></a>01022                 $object = $this-&gt;<a class="code" href="a00003_d6600356585a48f822674ccadde146c8.html#d6600356585a48f822674ccadde146c8">head_object</a>($bucket, $filename);
<a name="l01023"></a>01023                 $filesize = (integer) $object-&gt;header[<span class="stringliteral">'content-length'</span>];
<a name="l01024"></a>01024 
<a name="l01025"></a>01025                 <span class="keywordflow">if</span> ($friendly_format)
<a name="l01026"></a>01026                 {
<a name="l01027"></a>01027                         $filesize = $this-&gt;util-&gt;size_readable($filesize);
<a name="l01028"></a>01028                 }
<a name="l01029"></a>01029 
<a name="l01030"></a>01030                 <span class="keywordflow">return</span> $filesize;
<a name="l01031"></a>01031         }
<a name="l01032"></a>01032 <span class="comment"></span>
<a name="l01033"></a>01033 <span class="comment">        /**</span>
<a name="l01034"></a>01034 <span class="comment">         * Get Object List</span>
<a name="l01035"></a>01035 <span class="comment">         * </span>
<a name="l01036"></a>01036 <span class="comment">         * ONLY lists the object filenames from a bucket.</span>
<a name="l01037"></a>01037 <span class="comment">         *</span>
<a name="l01038"></a>01038 <span class="comment">         * @access public</span>
<a name="l01039"></a>01039 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used.</span>
<a name="l01040"></a>01040 <span class="comment">         * @param array $opt (Optional) Associative array of parameters which can have the following keys:</span>
<a name="l01041"></a>01041 <span class="comment">         * &lt;ul&gt;</span>
<a name="l01042"></a>01042 <span class="comment">         *   &lt;li&gt;string prefix - (Optional) Restricts the response to only contain results that begin with the specified prefix.&lt;/li&gt;</span>
<a name="l01043"></a>01043 <span class="comment">         *   &lt;li&gt;string marker - (Optional) It restricts the response to only contain results that occur alphabetically after the value of marker.&lt;/li&gt;</span>
<a name="l01044"></a>01044 <span class="comment">         *   &lt;li&gt;string maxKeys - (Optional) Limits the number of results returned in response to your query. Will return no more than this number of results, but possibly less.&lt;/li&gt;</span>
<a name="l01045"></a>01045 <span class="comment">         *   &lt;li&gt;string delimiter - (Optional) Unicode string parameter. Keys that contain the same string between the prefix and the first occurrence of the delimiter will be rolled up into a single result element in the CommonPrefixes collection.&lt;/li&gt;</span>
<a name="l01046"></a>01046 <span class="comment">         *   &lt;li&gt;string pcre - (Optional) A Perl-Compatible Regular Expression (PCRE) to filter the filenames against. This is applied AFTER any native S3 filtering from 'prefix', 'marker', 'maxKeys', or 'delimiter'.&lt;/li&gt;</span>
<a name="l01047"></a>01047 <span class="comment">         * &lt;/ul&gt;</span>
<a name="l01048"></a>01048 <span class="comment">         * @return array</span>
<a name="l01049"></a>01049 <span class="comment">         * @section example Example Usage:</span>
<a name="l01050"></a>01050 <span class="comment">         * @include s3/get_object_list.phps</span>
<a name="l01051"></a>01051 <span class="comment">         * @see list_objects</span>
<a name="l01052"></a>01052 <span class="comment">         */</span>
<a name="l01053"></a><a class="code" href="a00003_58758d28b2b11c5a98c635c34092f7be.html#58758d28b2b11c5a98c635c34092f7be">01053</a>         <span class="keyword">public</span> function <a class="code" href="a00003_58758d28b2b11c5a98c635c34092f7be.html#58758d28b2b11c5a98c635c34092f7be">get_object_list</a>($bucket, $opt = null)
<a name="l01054"></a>01054         {
<a name="l01055"></a>01055                 <span class="comment">// Set some default values</span>
<a name="l01056"></a>01056                 $filenames = array();
<a name="l01057"></a>01057                 $pcre = null;
<a name="l01058"></a>01058 
<a name="l01059"></a>01059                 <span class="comment">// Get a list of files.</span>
<a name="l01060"></a>01060                 $list = $this-&gt;<a class="code" href="a00003_db502170660cf3cd5d19b337bfbc8382.html#db502170660cf3cd5d19b337bfbc8382">list_objects</a>($bucket, $opt);
<a name="l01061"></a>01061 
<a name="l01062"></a>01062                 <span class="comment">// Extract the options</span>
<a name="l01063"></a>01063                 <span class="keywordflow">if</span> ($opt)
<a name="l01064"></a>01064                 {
<a name="l01065"></a>01065                         extract($opt);
<a name="l01066"></a>01066                 }
<a name="l01067"></a>01067 
<a name="l01068"></a>01068                 <span class="comment">// If we have a PCRE regex, store it.</span>
<a name="l01069"></a>01069                 <span class="keywordflow">if</span> ($pcre)
<a name="l01070"></a>01070                 {
<a name="l01071"></a>01071                         <span class="comment">// Loop through and find the filenames.</span>
<a name="l01072"></a>01072                         <span class="keywordflow">foreach</span> ($list-&gt;body-&gt;Contents as $file)
<a name="l01073"></a>01073                         {
<a name="l01074"></a>01074                                 $file = (string) $file-&gt;Key;
<a name="l01075"></a>01075 
<a name="l01076"></a>01076                                 <span class="keywordflow">if</span> (preg_match($pcre, $file))
<a name="l01077"></a>01077                                 {
<a name="l01078"></a>01078                                         $filenames[] = $file;
<a name="l01079"></a>01079                                 }
<a name="l01080"></a>01080                         }
<a name="l01081"></a>01081                 }
<a name="l01082"></a>01082                 <span class="keywordflow">else</span>
<a name="l01083"></a>01083                 {
<a name="l01084"></a>01084                         <span class="comment">// Loop through and find the filenames.</span>
<a name="l01085"></a>01085                         <span class="keywordflow">foreach</span> ($list-&gt;body-&gt;Contents as $file)
<a name="l01086"></a>01086                         {
<a name="l01087"></a>01087                                 $filenames[] = (string) $file-&gt;Key;
<a name="l01088"></a>01088                         }
<a name="l01089"></a>01089                 }
<a name="l01090"></a>01090 
<a name="l01091"></a>01091                 <span class="keywordflow">return</span> (count($filenames) &gt; 0) ? $filenames : null;
<a name="l01092"></a>01092         }
<a name="l01093"></a>01093 <span class="comment"></span>
<a name="l01094"></a>01094 <span class="comment">        /**</span>
<a name="l01095"></a>01095 <span class="comment">         * Copy Object</span>
<a name="l01096"></a>01096 <span class="comment">         * </span>
<a name="l01097"></a>01097 <span class="comment">         * Copies an object to a new location.</span>
<a name="l01098"></a>01098 <span class="comment">         * </span>
<a name="l01099"></a>01099 <span class="comment">         * @access public</span>
<a name="l01100"></a>01100 <span class="comment">         * @param string $source_bucket (Required) The name of the bucket that contains the source file.</span>
<a name="l01101"></a>01101 <span class="comment">         * @param string $source_filename (Required) The source filename that you want to copy.</span>
<a name="l01102"></a>01102 <span class="comment">         * @param string $dest_bucket (Required) The name of the bucket that you want to copy the file to.</span>
<a name="l01103"></a>01103 <span class="comment">         * @param string $dest_filename (Required) The filename that you want to give to the copy.</span>
<a name="l01104"></a>01104 <span class="comment">         * @param array $opt (Optional) Associative array of parameters which can have the following keys:</span>
<a name="l01105"></a>01105 <span class="comment">         * &lt;ul&gt;</span>
<a name="l01106"></a>01106 <span class="comment">         *   &lt;li&gt;string acl - (Optional) One of the following options: S3_ACL_PRIVATE, S3_ACL_PUBLIC, S3_ACL_OPEN, or S3_ACL_AUTH_READ. Defaults to S3_ACL_PRIVATE.&lt;/li&gt;</span>
<a name="l01107"></a>01107 <span class="comment">         *   &lt;li&gt;boolean returnCurlHandle - (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.&lt;/li&gt;</span>
<a name="l01108"></a>01108 <span class="comment">         *   &lt;li&gt;array meta - (Optional) Associative array of key-value pairs. Represented by x-amz-meta-: Any header starting with this prefix is considered user metadata. It will be stored with the object and returned when you retrieve the object. The total size of the HTTP request, not including the body, must be less than 4 KB.&lt;/li&gt;</span>
<a name="l01109"></a>01109 <span class="comment">         * &lt;/ul&gt;</span>
<a name="l01110"></a>01110 <span class="comment">         * @section example Example Usage:</span>
<a name="l01111"></a>01111 <span class="comment">         * @include s3/copy_object.phps</span>
<a name="l01112"></a>01112 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?RESTObjectCOPY.html</span>
<a name="l01113"></a>01113 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?UsingCopyingObjects.html</span>
<a name="l01114"></a>01114 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?RESTObjectPUT.html#RESTObjectPUTRequestHeaders</span>
<a name="l01115"></a>01115 <span class="comment">         */</span>
<a name="l01116"></a><a class="code" href="a00003_ee2902fc46016bb37e6c88d858ae7751.html#ee2902fc46016bb37e6c88d858ae7751">01116</a>         <span class="keyword">public</span> function <a class="code" href="a00003_ee2902fc46016bb37e6c88d858ae7751.html#ee2902fc46016bb37e6c88d858ae7751">copy_object</a>($source_bucket, $source_filename, $dest_bucket, $dest_filename, $opt = null)
<a name="l01117"></a>01117         {
<a name="l01118"></a>01118                 <span class="comment">// Add this to our request</span>
<a name="l01119"></a>01119                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_12f047cd6da4c2ebf4f768664dfc8cb8.html#12f047cd6da4c2ebf4f768664dfc8cb8">HTTP_PUT</a>;
<a name="l01120"></a>01120                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'copy_object'</span>;
<a name="l01121"></a>01121                 $opt[<span class="stringliteral">'sourceBucket'</span>] = $source_bucket;
<a name="l01122"></a>01122                 $opt[<span class="stringliteral">'sourceObject'</span>] = $source_filename;
<a name="l01123"></a>01123                 $opt[<span class="stringliteral">'destinationBucket'</span>] = $dest_bucket;
<a name="l01124"></a>01124                 $opt[<span class="stringliteral">'destinationObject'</span>] = $dest_filename;
<a name="l01125"></a>01125                 $opt[<span class="stringliteral">'filename'</span>] = rawurlencode($dest_filename);
<a name="l01126"></a>01126                 $opt[<span class="stringliteral">'metadataDirective'</span>] = <span class="stringliteral">'COPY'</span>;
<a name="l01127"></a>01127 
<a name="l01128"></a>01128                 <span class="comment">// Do we have metadata?</span>
<a name="l01129"></a>01129                 <span class="keywordflow">if</span> (isset($opt[<span class="stringliteral">'meta'</span>]) &amp;&amp; is_array($opt[<span class="stringliteral">'meta'</span>]))
<a name="l01130"></a>01130                 {
<a name="l01131"></a>01131                         $opt[<span class="stringliteral">'metadataDirective'</span>] = <span class="stringliteral">'REPLACE'</span>;
<a name="l01132"></a>01132                 }
<a name="l01133"></a>01133 
<a name="l01134"></a>01134                 <span class="comment">// Authenticate to S3</span>
<a name="l01135"></a>01135                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($dest_bucket, $opt);
<a name="l01136"></a>01136         }
<a name="l01137"></a>01137 <span class="comment"></span>
<a name="l01138"></a>01138 <span class="comment">        /**</span>
<a name="l01139"></a>01139 <span class="comment">         * Duplicate Object</span>
<a name="l01140"></a>01140 <span class="comment">         * </span>
<a name="l01141"></a>01141 <span class="comment">         * Identical to copy_object(), except that it only copies within a single bucket.</span>
<a name="l01142"></a>01142 <span class="comment">         * </span>
<a name="l01143"></a>01143 <span class="comment">         * @access public</span>
<a name="l01144"></a>01144 <span class="comment">         * @param string $bucket (Required) The name of the bucket that contains the file.</span>
<a name="l01145"></a>01145 <span class="comment">         * @param string $source_filename (Required) The source filename that you want to copy.</span>
<a name="l01146"></a>01146 <span class="comment">         * @param string $dest_filename (Required) The filename that you want to give to the copy.</span>
<a name="l01147"></a>01147 <span class="comment">         * @param string $acl - (Optional) One of the following options: S3_ACL_PRIVATE, S3_ACL_PUBLIC, S3_ACL_OPEN, or S3_ACL_AUTH_READ. Defaults to S3_ACL_PRIVATE.</span>
<a name="l01148"></a>01148 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l01149"></a>01149 <span class="comment">         * @section example Example Usage:</span>
<a name="l01150"></a>01150 <span class="comment">         * @include s3/duplicate_object.phps</span>
<a name="l01151"></a>01151 <span class="comment">         */</span>
<a name="l01152"></a><a class="code" href="a00003_6767267f6da7fe2a65db3e9e3c599b20.html#6767267f6da7fe2a65db3e9e3c599b20">01152</a>         <span class="keyword">public</span> function <a class="code" href="a00003_6767267f6da7fe2a65db3e9e3c599b20.html#6767267f6da7fe2a65db3e9e3c599b20">duplicate_object</a>($bucket, $source_filename, $dest_filename, $acl = <a class="code" href="a00017_26b272ddfab8427eac3d883fb4f0356f.html#26b272ddfab8427eac3d883fb4f0356f">S3_ACL_PRIVATE</a>)
<a name="l01153"></a>01153         {
<a name="l01154"></a>01154                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_ee2902fc46016bb37e6c88d858ae7751.html#ee2902fc46016bb37e6c88d858ae7751">copy_object</a>($bucket, $source_filename, $bucket, $dest_filename, array(<span class="stringliteral">'acl'</span> =&gt; $acl));
<a name="l01155"></a>01155         }
<a name="l01156"></a>01156 <span class="comment"></span>
<a name="l01157"></a>01157 <span class="comment">        /**</span>
<a name="l01158"></a>01158 <span class="comment">         * Move Object</span>
<a name="l01159"></a>01159 <span class="comment">         * </span>
<a name="l01160"></a>01160 <span class="comment">         * Moves an object to a new location.</span>
<a name="l01161"></a>01161 <span class="comment">         * </span>
<a name="l01162"></a>01162 <span class="comment">         * @access public</span>
<a name="l01163"></a>01163 <span class="comment">         * @param string $source_bucket (Required) The name of the bucket that contains the source file.</span>
<a name="l01164"></a>01164 <span class="comment">         * @param string $source_filename (Required) The source filename that you want to copy.</span>
<a name="l01165"></a>01165 <span class="comment">         * @param string $dest_bucket (Required) The name of the bucket that you want to copy the file to.</span>
<a name="l01166"></a>01166 <span class="comment">         * @param string $dest_filename (Required) The filename that you want to give to the copy.</span>
<a name="l01167"></a>01167 <span class="comment">         * @param string $acl - (Optional) One of the following options: S3_ACL_PRIVATE, S3_ACL_PUBLIC, S3_ACL_OPEN, or S3_ACL_AUTH_READ. Defaults to S3_ACL_PRIVATE.</span>
<a name="l01168"></a>01168 <span class="comment">         * @return array</span>
<a name="l01169"></a>01169 <span class="comment">         * @section example Example Usage:</span>
<a name="l01170"></a>01170 <span class="comment">         * @include s3/move_object.phps</span>
<a name="l01171"></a>01171 <span class="comment">         */</span>
<a name="l01172"></a><a class="code" href="a00003_76f97be3d6668ca18c22ec5b9177977b.html#76f97be3d6668ca18c22ec5b9177977b">01172</a>         <span class="keyword">public</span> function <a class="code" href="a00003_76f97be3d6668ca18c22ec5b9177977b.html#76f97be3d6668ca18c22ec5b9177977b">move_object</a>($source_bucket, $source_filename, $dest_bucket, $dest_filename, $acl = <a class="code" href="a00017_26b272ddfab8427eac3d883fb4f0356f.html#26b272ddfab8427eac3d883fb4f0356f">S3_ACL_PRIVATE</a>)
<a name="l01173"></a>01173         {
<a name="l01174"></a>01174                 $return = array();
<a name="l01175"></a>01175                 $return[<span class="stringliteral">'copy'</span>] = $this-&gt;<a class="code" href="a00003_ee2902fc46016bb37e6c88d858ae7751.html#ee2902fc46016bb37e6c88d858ae7751">copy_object</a>($source_bucket, $source_filename, $dest_bucket, $dest_filename, array(<span class="stringliteral">'acl'</span> =&gt; $acl));
<a name="l01176"></a>01176                 $return[<span class="stringliteral">'delete'</span>] = $this-&gt;<a class="code" href="a00003_22a2cc306d129bb28032d38d0774950c.html#22a2cc306d129bb28032d38d0774950c">delete_object</a>($source_bucket, $source_filename);
<a name="l01177"></a>01177                 <span class="keywordflow">return</span> $return;
<a name="l01178"></a>01178         }
<a name="l01179"></a>01179 <span class="comment"></span>
<a name="l01180"></a>01180 <span class="comment">        /**</span>
<a name="l01181"></a>01181 <span class="comment">         * Rename Object</span>
<a name="l01182"></a>01182 <span class="comment">         * </span>
<a name="l01183"></a>01183 <span class="comment">         * Identical to move_object(), except that it only moves within a single bucket.</span>
<a name="l01184"></a>01184 <span class="comment">         * </span>
<a name="l01185"></a>01185 <span class="comment">         * @access public</span>
<a name="l01186"></a>01186 <span class="comment">         * @param string $bucket (Required) The name of the bucket that contains the file.</span>
<a name="l01187"></a>01187 <span class="comment">         * @param string $source_filename (Required) The source filename that you want to copy.</span>
<a name="l01188"></a>01188 <span class="comment">         * @param string $dest_filename (Required) The filename that you want to give to the copy.</span>
<a name="l01189"></a>01189 <span class="comment">         * @param string $acl - (Optional) One of the following options: S3_ACL_PRIVATE, S3_ACL_PUBLIC, S3_ACL_OPEN, or S3_ACL_AUTH_READ. Defaults to S3_ACL_PRIVATE.</span>
<a name="l01190"></a>01190 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l01191"></a>01191 <span class="comment">         * @section example Example Usage:</span>
<a name="l01192"></a>01192 <span class="comment">         * @include s3/rename_object.phps</span>
<a name="l01193"></a>01193 <span class="comment">         */</span>
<a name="l01194"></a><a class="code" href="a00003_a16bc5f1ce9d8eb41e3155361ac984f7.html#a16bc5f1ce9d8eb41e3155361ac984f7">01194</a>         <span class="keyword">public</span> function <a class="code" href="a00003_a16bc5f1ce9d8eb41e3155361ac984f7.html#a16bc5f1ce9d8eb41e3155361ac984f7">rename_object</a>($bucket, $source_filename, $dest_filename, $acl = <a class="code" href="a00017_26b272ddfab8427eac3d883fb4f0356f.html#26b272ddfab8427eac3d883fb4f0356f">S3_ACL_PRIVATE</a>)
<a name="l01195"></a>01195         {
<a name="l01196"></a>01196                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_76f97be3d6668ca18c22ec5b9177977b.html#76f97be3d6668ca18c22ec5b9177977b">move_object</a>($bucket, $source_filename, $bucket, $dest_filename, $acl);
<a name="l01197"></a>01197         }
<a name="l01198"></a>01198 <span class="comment"></span>
<a name="l01199"></a>01199 <span class="comment">        /**</span>
<a name="l01200"></a>01200 <span class="comment">         * Get Object ACL</span>
<a name="l01201"></a>01201 <span class="comment">         * </span>
<a name="l01202"></a>01202 <span class="comment">         * Gets the ACL settings for a object.</span>
<a name="l01203"></a>01203 <span class="comment">         * </span>
<a name="l01204"></a>01204 <span class="comment">         * @access public</span>
<a name="l01205"></a>01205 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used.</span>
<a name="l01206"></a>01206 <span class="comment">         * @param string $filename (Required) The filename for the content.</span>
<a name="l01207"></a>01207 <span class="comment">         * @param boolean $returnCurlHandle (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.</span>
<a name="l01208"></a>01208 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l01209"></a>01209 <span class="comment">         * @section example Example Usage:</span>
<a name="l01210"></a>01210 <span class="comment">         * @include s3/get_object_acl.phps</span>
<a name="l01211"></a>01211 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?RESTAccessPolicy.html</span>
<a name="l01212"></a>01212 <span class="comment">         */</span>
<a name="l01213"></a><a class="code" href="a00003_389b71935845272272e0a72577eca482.html#389b71935845272272e0a72577eca482">01213</a>         <span class="keyword">public</span> function <a class="code" href="a00003_389b71935845272272e0a72577eca482.html#389b71935845272272e0a72577eca482">get_object_acl</a>($bucket, $filename, $returnCurlHandle = null)
<a name="l01214"></a>01214         {
<a name="l01215"></a>01215                 <span class="comment">// Add this to our request</span>
<a name="l01216"></a>01216                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_bee436b68fa82c549b1067404e0c33fe.html#bee436b68fa82c549b1067404e0c33fe">HTTP_GET</a>;
<a name="l01217"></a>01217                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'get_object_acl'</span>;
<a name="l01218"></a>01218                 $opt[<span class="stringliteral">'filename'</span>] = $filename;
<a name="l01219"></a>01219                 $opt[<span class="stringliteral">'returnCurlHandle'</span>] = $returnCurlHandle;
<a name="l01220"></a>01220 
<a name="l01221"></a>01221                 <span class="comment">// Authenticate to S3</span>
<a name="l01222"></a>01222                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l01223"></a>01223         }
<a name="l01224"></a>01224 <span class="comment"></span>
<a name="l01225"></a>01225 <span class="comment">        /**</span>
<a name="l01226"></a>01226 <span class="comment">         * Set Object ACL</span>
<a name="l01227"></a>01227 <span class="comment">         * </span>
<a name="l01228"></a>01228 <span class="comment">         * Sets the ACL settings for a object.</span>
<a name="l01229"></a>01229 <span class="comment">         * </span>
<a name="l01230"></a>01230 <span class="comment">         * @access public</span>
<a name="l01231"></a>01231 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used.</span>
<a name="l01232"></a>01232 <span class="comment">         * @param string $filename (Required) The filename for the content.</span>
<a name="l01233"></a>01233 <span class="comment">         * @param boolean $returnCurlHandle (Optional) A private toggle that will return the CURL handle for the request rather than actually completing the request. This is useful for MultiCURL requests.</span>
<a name="l01234"></a>01234 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l01235"></a>01235 <span class="comment">         * @section example Example Usage:</span>
<a name="l01236"></a>01236 <span class="comment">         * @include s3/set_object_acl.phps</span>
<a name="l01237"></a>01237 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?RESTAccessPolicy.html</span>
<a name="l01238"></a>01238 <span class="comment">         */</span>
<a name="l01239"></a><a class="code" href="a00003_1e5fe3f4f0a133b53ce5729a33755961.html#1e5fe3f4f0a133b53ce5729a33755961">01239</a>         <span class="keyword">public</span> function <a class="code" href="a00003_1e5fe3f4f0a133b53ce5729a33755961.html#1e5fe3f4f0a133b53ce5729a33755961">set_object_acl</a>($bucket, $filename, $acl = <a class="code" href="a00017_26b272ddfab8427eac3d883fb4f0356f.html#26b272ddfab8427eac3d883fb4f0356f">S3_ACL_PRIVATE</a>, $returnCurlHandle = null)
<a name="l01240"></a>01240         {
<a name="l01241"></a>01241                 <span class="comment">// Add this to our request</span>
<a name="l01242"></a>01242                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_12f047cd6da4c2ebf4f768664dfc8cb8.html#12f047cd6da4c2ebf4f768664dfc8cb8">HTTP_PUT</a>;
<a name="l01243"></a>01243                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'set_object_acl'</span>;
<a name="l01244"></a>01244                 $opt[<span class="stringliteral">'filename'</span>] = $filename;
<a name="l01245"></a>01245                 $opt[<span class="stringliteral">'returnCurlHandle'</span>] = $returnCurlHandle;
<a name="l01246"></a>01246                 $opt[<span class="stringliteral">'acl'</span>] = $acl;
<a name="l01247"></a>01247 
<a name="l01248"></a>01248                 <span class="comment">// Authenticate to S3</span>
<a name="l01249"></a>01249                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l01250"></a>01250         }
<a name="l01251"></a>01251 
<a name="l01252"></a>01252 
<a name="l01253"></a>01253         <span class="comment">/*%******************************************************************************************%*/</span>
<a name="l01254"></a>01254         <span class="comment">// LOGGING METHODS</span>
<a name="l01255"></a>01255 <span class="comment"></span>
<a name="l01256"></a>01256 <span class="comment">        /**</span>
<a name="l01257"></a>01257 <span class="comment">         * Get Logs</span>
<a name="l01258"></a>01258 <span class="comment">         * </span>
<a name="l01259"></a>01259 <span class="comment">         * Get the access logs associated with a given bucket.</span>
<a name="l01260"></a>01260 <span class="comment">         * </span>
<a name="l01261"></a>01261 <span class="comment">         * @access public</span>
<a name="l01262"></a>01262 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used. Pass null if using AmazonS3::set_vhost().</span>
<a name="l01263"></a>01263 <span class="comment">         * @return TarzanHTTPResponse</span>
<a name="l01264"></a>01264 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?ServerLogs.html</span>
<a name="l01265"></a>01265 <span class="comment">         */</span>
<a name="l01266"></a><a class="code" href="a00003_c5e0d8a7c97a676793db8f6c2864df0d.html#c5e0d8a7c97a676793db8f6c2864df0d">01266</a>         <span class="keyword">public</span> function <a class="code" href="a00003_c5e0d8a7c97a676793db8f6c2864df0d.html#c5e0d8a7c97a676793db8f6c2864df0d">get_logs</a>($bucket)
<a name="l01267"></a>01267         {
<a name="l01268"></a>01268                 <span class="comment">// Add this to our request</span>
<a name="l01269"></a>01269                 $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_bee436b68fa82c549b1067404e0c33fe.html#bee436b68fa82c549b1067404e0c33fe">HTTP_GET</a>;
<a name="l01270"></a>01270                 $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'get_logs'</span>;
<a name="l01271"></a>01271 
<a name="l01272"></a>01272                 <span class="comment">// Authenticate to S3</span>
<a name="l01273"></a>01273                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l01274"></a>01274         }
<a name="l01275"></a>01275 <span class="comment"></span>
<a name="l01276"></a>01276 <span class="comment">        /**</span>
<a name="l01277"></a>01277 <span class="comment">         * Toggle Logging</span>
<a name="l01278"></a>01278 <span class="comment">         * </span>
<a name="l01279"></a>01279 <span class="comment">         * Enable/Disable bucket logging.</span>
<a name="l01280"></a>01280 <span class="comment">         * </span>
<a name="l01281"></a>01281 <span class="comment">         * @todo Implement this method.</span>
<a name="l01282"></a>01282 <span class="comment">         */</span>
<a name="l01283"></a><a class="code" href="a00003_929091a637100249ce35a2eecbc1a348.html#929091a637100249ce35a2eecbc1a348">01283</a>         <span class="keyword">public</span> function <a class="code" href="a00003_929091a637100249ce35a2eecbc1a348.html#929091a637100249ce35a2eecbc1a348">toggle_logging</a>()
<a name="l01284"></a>01284         {
<a name="l01285"></a>01285                 
<a name="l01286"></a>01286         }
<a name="l01287"></a>01287 <span class="comment"></span>
<a name="l01288"></a>01288 <span class="comment">        /**</span>
<a name="l01289"></a>01289 <span class="comment">         * Set Logging Permissions</span>
<a name="l01290"></a>01290 <span class="comment">         * </span>
<a name="l01291"></a>01291 <span class="comment">         * Determine the permissions for managing the logging process.</span>
<a name="l01292"></a>01292 <span class="comment">         * </span>
<a name="l01293"></a>01293 <span class="comment">         * @todo Implement this method.</span>
<a name="l01294"></a>01294 <span class="comment">         */</span>
<a name="l01295"></a><a class="code" href="a00003_24e1a7d3591af5fc2240eba51cd619a3.html#24e1a7d3591af5fc2240eba51cd619a3">01295</a>         <span class="keyword">public</span> function <a class="code" href="a00003_24e1a7d3591af5fc2240eba51cd619a3.html#24e1a7d3591af5fc2240eba51cd619a3">set_logging_permissions</a>()
<a name="l01296"></a>01296         {
<a name="l01297"></a>01297                 
<a name="l01298"></a>01298         }
<a name="l01299"></a>01299 
<a name="l01300"></a>01300 
<a name="l01301"></a>01301         <span class="comment">/*%******************************************************************************************%*/</span>
<a name="l01302"></a>01302         <span class="comment">// MISCELLANEOUS METHODS</span>
<a name="l01303"></a>01303 <span class="comment"></span>
<a name="l01304"></a>01304 <span class="comment">        /**</span>
<a name="l01305"></a>01305 <span class="comment">         * Store Remote File</span>
<a name="l01306"></a>01306 <span class="comment">         * </span>
<a name="l01307"></a>01307 <span class="comment">         * Takes an existing remote file, stores it to S3, and returns a URL.</span>
<a name="l01308"></a>01308 <span class="comment">         * </span>
<a name="l01309"></a>01309 <span class="comment">         * @access public</span>
<a name="l01310"></a>01310 <span class="comment">         * @param string $remote_file (Required) The full URL of the file to store on the S3 service.</span>
<a name="l01311"></a>01311 <span class="comment">         * @param string $bucket (Required) The name of the bucket that you want to store it in.</span>
<a name="l01312"></a>01312 <span class="comment">         * @param string $filename (Required) The name that you want to give to the file.</span>
<a name="l01313"></a>01313 <span class="comment">         * @param array $opt (Optional) Associative array of parameters which can have the following keys:</span>
<a name="l01314"></a>01314 <span class="comment">         * &lt;ul&gt;</span>
<a name="l01315"></a>01315 <span class="comment">         *   &lt;li&gt;string acl - (Optional) One of the following options: S3_ACL_PRIVATE, S3_ACL_PUBLIC, S3_ACL_OPEN, or S3_ACL_AUTH_READ. Defaults to S3_ACL_PUBLIC.&lt;/li&gt;</span>
<a name="l01316"></a>01316 <span class="comment">         *   &lt;li&gt;string overwrite - (Optional) If set to true, checks to see if the file exists and will overwrite the old data with new data. Defaults to false.&lt;/li&gt;</span>
<a name="l01317"></a>01317 <span class="comment">         * &lt;/ul&gt;</span>
<a name="l01318"></a>01318 <span class="comment">         * @return string The S3 URL for the uploaded file. Returns null if unsuccessful.</span>
<a name="l01319"></a>01319 <span class="comment">         * @section example Example Usage:</span>
<a name="l01320"></a>01320 <span class="comment">         * @include s3/store_remote_file.phps</span>
<a name="l01321"></a>01321 <span class="comment">         */</span>
<a name="l01322"></a><a class="code" href="a00003_ad632f7748de7abea6c4716186ad0579.html#ad632f7748de7abea6c4716186ad0579">01322</a>         <span class="keyword">public</span> function <a class="code" href="a00003_ad632f7748de7abea6c4716186ad0579.html#ad632f7748de7abea6c4716186ad0579">store_remote_file</a>($remote_file, $bucket, $filename, $opt = null)
<a name="l01323"></a>01323         {
<a name="l01324"></a>01324                 <span class="comment">// Set default values.</span>
<a name="l01325"></a>01325                 $acl = <a class="code" href="a00017_8a93bf8a4901a811870a8af621ab285e.html#8a93bf8a4901a811870a8af621ab285e">S3_ACL_PUBLIC</a>;
<a name="l01326"></a>01326                 $overwrite = <span class="keyword">false</span>;
<a name="l01327"></a>01327                 $cname = null;
<a name="l01328"></a>01328 
<a name="l01329"></a>01329                 <span class="keywordflow">if</span> ($opt)
<a name="l01330"></a>01330                 {
<a name="l01331"></a>01331                         <span class="comment">// Break the options out.</span>
<a name="l01332"></a>01332                         extract($opt);
<a name="l01333"></a>01333                 }
<a name="l01334"></a>01334 
<a name="l01335"></a>01335                 <span class="comment">// Does the file already exist?</span>
<a name="l01336"></a>01336                 $object = $this-&gt;<a class="code" href="a00003_d6600356585a48f822674ccadde146c8.html#d6600356585a48f822674ccadde146c8">head_object</a>($bucket, $filename);
<a name="l01337"></a>01337 
<a name="l01338"></a>01338                 <span class="comment">// As long as it doesn't already exist, fetch and store it.</span>
<a name="l01339"></a>01339                 <span class="keywordflow">if</span> (!$object-&gt;isOK() || $overwrite)
<a name="l01340"></a>01340                 {
<a name="l01341"></a>01341                         <span class="comment">// Fetch the file</span>
<a name="l01342"></a>01342                         $file = <span class="keyword">new</span> $this-&gt;request_class($remote_file);
<a name="l01343"></a>01343                         $file-&gt;sendRequest();
<a name="l01344"></a>01344 
<a name="l01345"></a>01345                         <span class="comment">// Store it in S3</span>
<a name="l01346"></a>01346                         unset($object);
<a name="l01347"></a>01347                         $object = $this-&gt;<a class="code" href="a00003_573980f90cc214e190d74a2de0010492.html#573980f90cc214e190d74a2de0010492">create_object</a>($bucket, array(
<a name="l01348"></a>01348                                 <span class="stringliteral">'filename'</span> =&gt; $filename,
<a name="l01349"></a>01349                                 <span class="stringliteral">'body'</span> =&gt; $file-&gt;getResponseBody(),
<a name="l01350"></a>01350                                 <span class="stringliteral">'contentType'</span> =&gt; $file-&gt;getResponseHeader(<span class="stringliteral">'content-type'</span>),
<a name="l01351"></a>01351                                 <span class="stringliteral">'acl'</span> =&gt; $acl
<a name="l01352"></a>01352                         ));
<a name="l01353"></a>01353                 }
<a name="l01354"></a>01354 
<a name="l01355"></a>01355                 <span class="comment">// Was the request successful?</span>
<a name="l01356"></a>01356                 <span class="keywordflow">if</span> ($object-&gt;isOK())
<a name="l01357"></a>01357                 {
<a name="l01358"></a>01358                         $url = $object-&gt;header[<span class="stringliteral">'x-tarzan-requesturl'</span>];
<a name="l01359"></a>01359 
<a name="l01360"></a>01360                         <span class="comment">// If we have a virtual host value, use that instead of Amazon's hostname. There are better ways of doing this, but it works for now.</span>
<a name="l01361"></a>01361                         <span class="keywordflow">if</span> ($this-&gt;vhost)
<a name="l01362"></a>01362                         {
<a name="l01363"></a>01363                                 $url = str_ireplace(<span class="stringliteral">'http://'</span>, <span class="stringliteral">''</span>, $url);
<a name="l01364"></a>01364                                 $url = explode(<span class="charliteral">'/'</span>, $url);
<a name="l01365"></a>01365                                 $url[0] = $this-&gt;vhost;
<a name="l01366"></a>01366                                 $url = <span class="stringliteral">'http://'</span> . implode(<span class="charliteral">'/'</span>, $url);
<a name="l01367"></a>01367                         }
<a name="l01368"></a>01368 
<a name="l01369"></a>01369                         <span class="keywordflow">return</span> $url;
<a name="l01370"></a>01370                 }
<a name="l01371"></a>01371                 <span class="keywordflow">else</span>
<a name="l01372"></a>01372                 {
<a name="l01373"></a>01373                         <span class="keywordflow">return</span> null;
<a name="l01374"></a>01374                 }
<a name="l01375"></a>01375         }
<a name="l01376"></a>01376 <span class="comment"></span>
<a name="l01377"></a>01377 <span class="comment">        /**</span>
<a name="l01378"></a>01378 <span class="comment">         * Get Object URL</span>
<a name="l01379"></a>01379 <span class="comment">         * </span>
<a name="l01380"></a>01380 <span class="comment">         * Gets the URL for the file.</span>
<a name="l01381"></a>01381 <span class="comment">         * </span>
<a name="l01382"></a>01382 <span class="comment">         * @access public</span>
<a name="l01383"></a>01383 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used. Pass null if using AmazonS3::set_vhost().</span>
<a name="l01384"></a>01384 <span class="comment">         * @param string $filename (Required) The filename for the content.</span>
<a name="l01385"></a>01385 <span class="comment">         * @param integer $qsa (Required) This doubles as a boolean (do you want to use Query String Authentication?) and an integer (how many seconds from now should this authentication work?). Defaults to 0/false.</span>
<a name="l01386"></a>01386 <span class="comment">         * @return string The file URL, with authentication parameters if requested.</span>
<a name="l01387"></a>01387 <span class="comment">         * @section example Example Usage:</span>
<a name="l01388"></a>01388 <span class="comment">         * @include s3/get_object_url.phps</span>
<a name="l01389"></a>01389 <span class="comment">         */</span>
<a name="l01390"></a><a class="code" href="a00003_ba6cfbdb199890da7f752826901b41bc.html#ba6cfbdb199890da7f752826901b41bc">01390</a>         <span class="keyword">public</span> function <a class="code" href="a00003_ba6cfbdb199890da7f752826901b41bc.html#ba6cfbdb199890da7f752826901b41bc">get_object_url</a>($bucket, $filename, $qsa = 0)
<a name="l01391"></a>01391         {
<a name="l01392"></a>01392                 <span class="keywordflow">if</span> ($qsa)
<a name="l01393"></a>01393                 {
<a name="l01394"></a>01394                         <span class="comment">// Add this to our request</span>
<a name="l01395"></a>01395                         $opt[<span class="stringliteral">'verb'</span>] = <a class="code" href="a00020_bee436b68fa82c549b1067404e0c33fe.html#bee436b68fa82c549b1067404e0c33fe">HTTP_GET</a>;
<a name="l01396"></a>01396                         $opt[<span class="stringliteral">'method'</span>] = <span class="stringliteral">'get_object_url'</span>;
<a name="l01397"></a>01397                         $opt[<span class="stringliteral">'filename'</span>] = $filename;
<a name="l01398"></a>01398                         $opt[<span class="stringliteral">'qsa'</span>] = $qsa;
<a name="l01399"></a>01399 
<a name="l01400"></a>01400                         <span class="comment">// Adjust the clock</span>
<a name="l01401"></a>01401                         $old_offset = $this-&gt;<a class="code" href="a00006_442c34311e9a195e3dff6ac7dbdd903d.html#442c34311e9a195e3dff6ac7dbdd903d">adjust_offset</a>;
<a name="l01402"></a>01402                         $this-&gt;<a class="code" href="a00006_442c34311e9a195e3dff6ac7dbdd903d.html#442c34311e9a195e3dff6ac7dbdd903d">adjust_offset</a>($qsa);
<a name="l01403"></a>01403 
<a name="l01404"></a>01404                         <span class="comment">// Authenticate to S3</span>
<a name="l01405"></a>01405                         $data = $this-&gt;<a class="code" href="a00003_7c6a8ca819cc3c46bbc83832316d5d34.html#7c6a8ca819cc3c46bbc83832316d5d34">authenticate</a>($bucket, $opt);
<a name="l01406"></a>01406 
<a name="l01407"></a>01407                         <span class="comment">// Reset the clock</span>
<a name="l01408"></a>01408                         $this-&gt;<a class="code" href="a00006_442c34311e9a195e3dff6ac7dbdd903d.html#442c34311e9a195e3dff6ac7dbdd903d">adjust_offset</a> = $old_offset;
<a name="l01409"></a>01409 
<a name="l01410"></a>01410                         <span class="keywordflow">if</span> ($this-&gt;vhost)
<a name="l01411"></a>01411                         {
<a name="l01412"></a>01412                                 <span class="keywordflow">return</span> <span class="stringliteral">'http://'</span> . $this-&gt;vhost . $data[<span class="stringliteral">'filename'</span>] . <span class="stringliteral">'?AWSAccessKeyId='</span> . $data[<span class="stringliteral">'key'</span>] . <span class="stringliteral">'&amp;Expires='</span> . $data[<span class="stringliteral">'expires'</span>] . <span class="stringliteral">'&amp;Signature='</span> . rawurlencode($data[<span class="stringliteral">'signature'</span>]);
<a name="l01413"></a>01413                         }
<a name="l01414"></a>01414                         
<a name="l01415"></a>01415                         <span class="keywordflow">return</span> <span class="stringliteral">'http://'</span> . $data[<span class="stringliteral">'bucket'</span>] . <span class="stringliteral">'.s3.amazonaws.com'</span> . $data[<span class="stringliteral">'filename'</span>] . <span class="stringliteral">'?AWSAccessKeyId='</span> . $data[<span class="stringliteral">'key'</span>] . <span class="stringliteral">'&amp;Expires='</span> . $data[<span class="stringliteral">'expires'</span>] . <span class="stringliteral">'&amp;Signature='</span> . rawurlencode($data[<span class="stringliteral">'signature'</span>]);
<a name="l01416"></a>01416                 }
<a name="l01417"></a>01417                 <span class="keywordflow">else</span>
<a name="l01418"></a>01418                 {
<a name="l01419"></a>01419                         <span class="comment">// If we're using a virtual host, use that instead.</span>
<a name="l01420"></a>01420                         <span class="keywordflow">if</span> ($this-&gt;vhost)
<a name="l01421"></a>01421                         {
<a name="l01422"></a>01422                                 <span class="keywordflow">return</span> <span class="stringliteral">'http://'</span> . $this-&gt;vhost . <span class="charliteral">'/'</span> . $filename;
<a name="l01423"></a>01423                         }
<a name="l01424"></a>01424 
<a name="l01425"></a>01425                         <span class="keywordflow">return</span> <span class="stringliteral">'http://'</span> . $bucket . <span class="stringliteral">'.s3.amazonaws.com/'</span> . $filename;
<a name="l01426"></a>01426                 }
<a name="l01427"></a>01427         }
<a name="l01428"></a>01428 <span class="comment"></span>
<a name="l01429"></a>01429 <span class="comment">        /**</span>
<a name="l01430"></a>01430 <span class="comment">         * Get Torrent URL</span>
<a name="l01431"></a>01431 <span class="comment">         * </span>
<a name="l01432"></a>01432 <span class="comment">         * Gets the URL for the torrent file for the file.</span>
<a name="l01433"></a>01433 <span class="comment">         * </span>
<a name="l01434"></a>01434 <span class="comment">         * @access public</span>
<a name="l01435"></a>01435 <span class="comment">         * @param string $bucket (Required) The name of the bucket to be used. Pass null if using AmazonS3::set_vhost().</span>
<a name="l01436"></a>01436 <span class="comment">         * @param string $filename (Required) The filename for the content.</span>
<a name="l01437"></a>01437 <span class="comment">         * @return string The Torrent URL.</span>
<a name="l01438"></a>01438 <span class="comment">         * @section example Example Usage:</span>
<a name="l01439"></a>01439 <span class="comment">         * @include s3/get_torrent_url.phps</span>
<a name="l01440"></a>01440 <span class="comment">         * @see http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?S3Torrent.html</span>
<a name="l01441"></a>01441 <span class="comment">         */</span>
<a name="l01442"></a><a class="code" href="a00003_caec29c4ea275db8b682ff6ecca1cec2.html#caec29c4ea275db8b682ff6ecca1cec2">01442</a>         <span class="keyword">public</span> function <a class="code" href="a00003_caec29c4ea275db8b682ff6ecca1cec2.html#caec29c4ea275db8b682ff6ecca1cec2">get_torrent_url</a>($bucket, $filename)
<a name="l01443"></a>01443         {
<a name="l01444"></a>01444                 <span class="comment">// If we're using a virtual host, use that instead.</span>
<a name="l01445"></a>01445                 <span class="keywordflow">if</span> ($this-&gt;vhost)
<a name="l01446"></a>01446                 {
<a name="l01447"></a>01447                         <span class="keywordflow">return</span> <span class="stringliteral">'http://'</span> . $this-&gt;vhost . <span class="charliteral">'/'</span> . $filename . <span class="stringliteral">'?torrent'</span>;
<a name="l01448"></a>01448                 }
<a name="l01449"></a>01449                 <span class="keywordflow">return</span> <span class="stringliteral">'http://'</span> . $bucket . <span class="stringliteral">'.s3.amazonaws.com/'</span> . $filename . <span class="stringliteral">'?torrent'</span>;
<a name="l01450"></a>01450         }
<a name="l01451"></a>01451 }
<a name="l01452"></a>01452 ?&gt;
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Aug 2 23:37:48 2008 for Tarzan Pre-2.0 Trunk Build by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
